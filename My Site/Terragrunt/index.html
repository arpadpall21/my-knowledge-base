<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <title> Terragrunt </title>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link rel="stylesheet" href="../Assets/stylesPages.css">
    <script src="../Assets/scriptPages.js"></script>
  </head>

  <body>
    <h1> Terragrunt </h1>
    <p> Updated: ( 2025-06-07 ) </p>
    <nav class="sitenav">
      <a href="../index.html">MySite > </a> Terragrunt
    </nav>

    <p class="subSite"><a href> SubSite > </a></p>

    <table class="table">
      <tr>
        <th style="width:30%;"> CMD </th>
        <th> Description </th>
      </tr>
      <tr>
        <td> <a href="https://terragrunt.gruntwork.io/docs/reference/cli/" target="_blank">terragrunt cmd</a></td>
        <td> - command reference </td>
      </tr>
      <tr>
        <td>|</td>
        <td></td>
      </tr>
      <tr>
        <td> terragrunt init </td>
        <td> 
          - initializes the terragrunt project (<a href="https://terragrunt.gruntwork.io/docs/features/auto-init/" target="_blank">automatically called on other commands like <mark>terragrunt plan</mark>)</a><br>
          - calls <mark>terraform|tofu init</mark> under the hood
        </td>
      </tr>
      <tr>
        <td>|</td>
        <td></td>
      </tr>
      <tr>
        <td colspan="2"> Unit Commands </td>
      </tr>
      <tr>
        <td>
          terragrunt <opt>[options]</opt> plan|apply|destroy
        </td>
        <td>
          - processes terragrunt configs then passes them to the <mark>terraform|tofu plan|apply|destroy</mark> command <br>
          <opt>[options]</opt><br>
          - (<opt>--log-format bare</opt>) less logs<br>
          - (<opt>--parallelism <optval>nr</optval></opt>) limits the number of parallel execution threads (Default: 10)
        </td>
      </tr>
      <tr>
        <td>|</td>
        <td></td>
      </tr>
      <tr>
        <td colspan="2"> Stack Commands </td>
      </tr>
      <tr>
        <td>
          terragrunt run --all plan|apply|destroy
        </td>
        <td>
          - runs an implicit stack (runs each underlying units)
        </td>
      </tr>
      <tr>
        <td>
          terragrunt run --all output
        </td>
        <td>
          - displays all outputs of each units in the stack 
        </td>
      </tr>
      <tr>
        <td>
          terragrunt run --all validate
        </td>
        <td>
          - syntax validates all the stack units' config files
        </td>
      </tr>
    </table>
    <br>
    <h2 class="headerSection"> Notes : </h2>

    <h2 class="headerSection"> Useful Links : </h2>
    <p><a href="https://terragrunt.gruntwork.io/docs/reference/hcl/attributes/" target="_blank"> reference: attributes (terragrunt.gruntwork.io) </a></p>
    <p><a href="https://terragrunt.gruntwork.io/docs/reference/hcl/blocks/" target="_blank"> reference: blocks (terragrunt.gruntwork.io) </a></p>
    <p><a href="https://terragrunt.gruntwork.io/docs/reference/hcl/functions/" target="_blank"> reference: functions (terragrunt.gruntwork.io) </a></p>
    <h2 class="headerSection"> Remember This : </h2>

    <h2 class="headerSection"> Description and Demonstration : </h2>
    <p> - Terragrunt is a thin wrapper around Terrafrom or OpenTofu (so esentially under the hood commands <mark>terraform</mark>|<mark>tofu</mark> are executed), so esentially terragrunt is an orchestration tool that extends the capabilities of terraform|OpenTofu </p>
    <p> - Terragrunt aims to improve Terraform|OpenTofu with: </p>
    <p class="indent-lv1"> - code reusability (DRY) (encourages to create modules then reuse them) </p>
    <p class="indent-lv1"> - certalized configuration aproach </p>
    <p class="indent-lv1"> - use environment specific config </p>
    <p> - Terragrunt uses <mark>.hcl</mark> files for its configurations, it's a convention to use <mark>terragrunt.hcl</mark> for unit configs and <mark>root.hcl</mark> of root module configs </p>
    <p> - there are 2 main Terragrunt concepts: </p>
    <p class="indent-lv1"> - <mark class="mark">Unit</mark> </p>
    <p class="indent-lv2"> - single instance of infrastructure managed by Terragrunt (directory containing a <mark>terragrunt.hcl</mark> file) </p>
    <p class="indent-lv2"> - atomic -> single block contains all its dependencies <u>and backend (state file)</u> </p>
    <p class="indent-lv2"> - under the hood Terragrunt basically executes <mark>terraform <reqval>cmd</reqval></mark> command on the unit </p>
    <p class="indent-lv1"> - <mark class="mark">Stack</mark> </p>
    <p class="indent-lv2"> - a collection of units, the main idea of stacks is to execute a collection of units </p>
    <p class="indent-lv2"> - there are 2 graph types: </p>
    <p class="indent-lv3"> - <mark class="mark">implicit stack</mark> </p>
    <p class="indent-lv4"> - basically any directory where the <mark>terragrunt run --all <reqval>cmd</reqval></mark> is executed, Terragrunt does a DAG then starts executing underlying units individually </p>
    <p class="indent-lv3"> - <mark class="mark">explicit stack</mark> </p>
    <p class="indent-lv4"> - this one uses a <mark>terragrunt.stack.hcl</mark> file which dynamicaly builds units (this one is a bit more involved, but I didn't found worth learning it at the time of writing this) <a href="https://terragrunt.gruntwork.io/docs/features/stacks/#explicit-stacks-blueprint-based-generation" target="_blank">[link]</a> </p>
    <!--------------------------------------------------------------------------->
    <hr>
    <h2 class="header"> Under the Hood Mechanics </h2>
    <p> - Terragrunt builds a DAG (Direct Acyclic Grap (which is basically a dependency tree) then starts <u>executing objects in parallel</u> (when possible, depending on dependencies), this mechanics is applied on both Unit and Stack levels </p>
    <p> - the <mark>.terragrunt-cache</mark> directory is used to cache unit specific files (recommended to be added to <mark>.gitignore</mark>) </p>
    <p> - the <mark>.terragrunt-stack</mark> directory is used to cache stack specific files (recommended to be added to <mark>.gitignore</mark>) </p>
    <p> - the <mark>.terraform.lock.hcl</mark> file is used to check the provider integrity (recommended to check in the version control) </p>
    <!--------------------------------------------------------------------------->
    <hr>
    <h2 class="header"> Config file (<mark>terragrunt.hcl</mark>) </h2>
    <p><a href="https://terragrunt.gruntwork.io/docs/reference/hcl/attributes/" target="_blank"> reference: attributes (terragrunt.gruntwork.io) </a></p>
    <p><a href="https://terragrunt.gruntwork.io/docs/reference/hcl/blocks/" target="_blank"> reference: blocks (terragrunt.gruntwork.io) </a></p>
    <p><a href="https://terragrunt.gruntwork.io/docs/reference/hcl/functions/" target="_blank"> reference: functions (terragrunt.gruntwork.io) </a></p>
    <pre class="syntax">
// terragrunt.hcl (file) --
    
    <a href="https:\/\/terragrunt.gruntwork.io/docs/reference/hcl/attributes/#inputs" target="_target">inputs</a> = {                        // <span class="openable">passes values to terraform|OpenTofu modules<div>
      <p> - these values are passed through environment varialbes to terraform|OpenTofu modules <a href="https://terragrunt.gruntwork.io/docs/reference/hcl/attributes/#inputs" target="_blank">[link]</a> </p>
    </div></span>
      <optval>terraformType</optval>
      <optval>...</optval>
    }
    
    <a href="https:\/\/terragrunt.gruntwork.io/docs/reference/hcl/blocks/#terraform" target="_target">terraform</a> = {     // describes how terragrunt interacts with Terraform|OpenTofu
      source = <reqval>path|url</reqval>                                // path to Terraform|OpenTofu config file
      extra_arguments = [<reqval>arg</reqval><optval>, ...</optval>]    // passess extra arguments to the <mark>terraform|tofu</mark> command
    }
    </pre>
    <!--------------------------------------------------------------------------->
    <hr>
    <h2 class="header"> Terragrunt project structure </h2>
    <pre>
// terragrunt's recommended project structure (demo) 
    
    my-terragrunt-project/
    ├── deployments/
    │   ├── root.hcl                                      // root module config 
    │   ├── dev/                                          // environments 
    │   │   ├── app/
    │   │   │   └── terragrunt.hcl                        // unit configs
    │   │   ├── db/
    │   │   │   └── terragrunt.hcl
    │   │   └── vpc/
    │   │       └── terragrunt.hcl
    │   ├── prod/
    │   │   ├── app/
    │   │   │   └── terragrunt.hcl
    │   │   ├── db/
    │   │   │   └── terragrunt.hcl
    │   │   └── vpc/
    │   │       └── terragrunt.hcl
    └── modules/                                          // modules (the idea is to reuse modules across environments)
        ├── app/
        │   └── main.tf
        ├── db/
        │   └── main.tf
        └── vpc/
            └── main.tf
    </pre>
    
    <!--
---------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------
stage 1: high level overview 
    - read through 
    - create notes 
    - deciede what exactly will you document down 
    - UNDERSTAND AND WRITE DOWN THE CONCEPTS!!!
    
stage 2:  low level overview
    - deeper understanding of all what you've taken down in stage 1
    
stage 3 : 
    - organize and document down everything 
---------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------

- demo mock data + explain why use it


At documentation I need a good example 


- the 'generate' block is used to generate files (whichi mostly used to create the provider.tf file)
- the 'include' block tells Terragrunt to use the exact same Terragrunt configuration from path (arg) (include the configuration)


- document the 'mock_outputs' in the 'dependency' block

- demo dynamically generate backend

- demo extra arguments (https://terragrunt.gruntwork.io/docs/features/extra-arguments/)

- demo before_hook, after_hook, error_hook (https://terragrunt.gruntwork.io/docs/features/hooks/)


?????????????????????????????????????????????????????????????????????????????????????????????
WRITE DOWN WHAT YOU DON'T UNDERSTAD OR MUST BE TESTED AS QUESTIONS HERE
?????????????????????????????????????????????????????????????????????????????????????????????
    - clairify this backend question
      - in general (depending on infrastructure size) terragrunt recommends to keep one state file per stack (per environment usually)
        - altough guys in my company keep a state file per unit

    - clarify from which version stack are introduces
-->









<!--

recommended to bo added to .gitignore
  - .terragrunt-cache
  - .terragrunt-stack

- .terraform.lock.hcl file
  - recommended to check in the version control (with the unit)
  - terraform uses it to check the provider integrity










- mention the .terragrunt.stack.hcl approach as well (I decided not to ducument it)








CMD: (https://terragrunt.gruntwork.io/docs/reference/cli/)
    basically all terraform commands can be executed but with 'terragrunt' instead of 'terraform'

    
    
According to Ned in the cloud terragrunt addresses 3 problems
    - Managing large configs
    - Managing different environments that uses the same config (module approach)
    - DRY code
    - Split up states









- stack can be executed individually or run all stacks that are in subdirectories
- terragrunt executes parallel deployment (executes stacks in parallel)
    - does this mean running terragrunt apply --all?

- terragrunt stored its cache files in .terragrunt-cache directory (which is tipically added to .gitignore)

Unit's Underlying mechanics
    - the 'terraform' block copies the referenced module into the current .terragrunt-cache
    - executes terraform plan|apply (depending terragrunt cmd)



- terragrunt is a wrapper around terraform (and openTofu)
    - orchestration tool 
    - extends the capabilities of Terraform/OpenTofu

- improves code reusability (reuse the same stack for different environments)
- provides centralized configuration approach
- environment specific config

- terragrunt uses .hcl files (tipicaly terragrunt.hcl) which is terraform's standard format
- it's common to have a root.hcl on the main directory and the child directories have the terragrunt.hcl file
    - a terragrunt.hcl file contains configurations for that stack




Concepts:
  - Unit: 
    - single instance or infrastructure managed by Terragrunt
    - can have its own state
    - basically a directory containing a terragrunt.hcl file
    - it's common to use a root.hcl in the main directory then use terragrunt.hcl in sub directories
    - units can be nested (a directory containing terragrunt.hcl file can contain further child units (dir with terragrunt.hcl file))
    - each stack can manage their own backend
    - units are atomic
  - Stack:
    - is a collection terraform units
    - manages dependencies between units
    - organizes the infrastructure into logical groups
    - 2 stack types:
      - implicit (directory structure)
        - basically auto detects units in folder structure
      - explicit (defined by terragrunt.stack.hcl file)
    
    ??? terragrunt.stack.hcl (central organization of related resources, like declaring local variables, etc...)
    - it's possible to have nested stack, this approach is used to namespace dependencies
    
    
    
  - Module:
    - a terraform or OpenTofu module which is reusable
    - it's commont to version modules
  - Resource:
    - terraform or OpenTofu resource
  - State:
    - terraform or OpenTofu state
  - DAG (Directed Acyclic Graph)
    - Teggragunt uses it to determine dependency order within a unit




- terragrunt first does dependency resolution (creates a direct acyclic grap DAG), then executes independed modules (stacks) in parallel



Parallel Execution: Terragrunt then executes the apply or plan commands for these independent modules concurrently, up to the limit specified by the --parallelism flag (default is 10). This means that if you have multiple modules that do not depend on each other, they can be processed simultaneously, significantly speeding up the overall execution time.


-->
    <br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
    <hr>
    <hr>
    <hr>
    <hr>
    <hr>

    <h2 class="headerExtra"><u> Title 1 </u></h2>
    <h2 class="header"> Title 1.1 </h2>
    <h3 class="header"> Title 1.1.1 </h3>
    <h4 class="header"> Title 1.1.1.1 </h4>
    <p> - stuff to learn <mark>syntax or command (or some tchnical stuff)</mark> bla bla bla </p>
    <p> - stuff to learn <mark class="mark">highlights like file names and other things</mark> bla bla bla </p>
    <p style="text-decoration:underline;"> - important information is underlined </p>
    <p style="color:yellow;"> - very important information is written with yellow colors </p>
    <p style="background-color:yellow;"> - highly important information has yellow background color </p>
    <div style="background-color:red;">
      <p> - red background block means not learned or not tested information! </p>
      <p> - </p>
    </div>

    <pre class="syntax">
    <reqval>required value </reqval>
    <optval>optional value </optval>
    <lit>literally used </lit>
    <opt>optionally used </opt>
  
    <prot style="color:#049500;">prototype chain</prot>
        
    <span class="openable"> this is an openable element<div>
        <p> - openable elements listed here in paragraphs </p>
        <p> - </p>
    </div></span>
    </pre>

    <details class="example">
      <summary> DEMO (can be pseudocode) </summary>
      <pre>
    examples of the current lessons 
    
// -----------------------------------------

// -----------------------------------------
    </pre>
    </details>

    <pre class="cmd">
    command line demo 
    </pre>
    <pre class="formula">
    formula code (like conversion meter...)
    </pre>
    <details class="example">
      <summary> Example : </summary>
      <h4 style="color:darkblue;"><u> example title </u></h4>
      <p> - live tests will come here </p>
      <details>
        <summary class="exampleCode"> CODE : </summary>
        <pre>
    copy of the exaple code 
        </pre>
      </details>
    </details>
    <!---------------------------------------------------------------------------------------------------------------------------------->
    <hr>

    <h2 class="test" style><a href="TEST/index.html"> TEST > </a></h2>

    <br><br>
  </body>

</html>