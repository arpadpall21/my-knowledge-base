<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title> REPL </title>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link rel="stylesheet" href="../../Assets/stylesPages.css">
    <script src="../../Assets/scriptPages.js"></script>
  </head>
  <body>
    <h1> REPL </h1>
    <p> Updated: ( 2019-09-01 / 2021-06-09 / 2025-03-21 )</p>
    <nav class="sitenav">
      <a href="../../index.html">MySite > </a>
      <a href="../index.html">Node.js > </a> REPL
    </nav>
    <table class="table">
      <caption>
        REPL Commands and Key Combinations
      </caption>
      <tr>
        <th style="width:30%;"> Command / Key Combination </th>
        <th> Description </th>
      </tr>
      <tr>
        <td> .help </td>
        <td>
          - show available REPL commands
        </td>
      </tr>
      <tr>
        <td>|</td>
        <td></td>
      </tr>
      <tr>
        <td> .exit </td>
        <td>
          - closes the I/O stream, causing REPL to exit ( <mark style="background-color:lightskyblue;">Ctrl + C</mark> )
        </td>
      </tr>
      <tr>
        <td>|</td>
        <td></td>
      </tr>
      <tr>
        <td> .clear </td>
        <td>
          - resets the REPL <mark>context</mark>
        </td>
      </tr>
      <tr>
        <td>|</td>
        <td></td>
      </tr>
      <tr>
        <td> .break </td>
        <td>
          - aborts further input or processing ( <mark style="background-color:lightskyblue;">Ctrl + C</mark> )
        </td>
      </tr>
      <tr>
        <td>|</td>
        <td></td>
      </tr>
      <tr>
        <td> _ </td>
        <td>
          - returns the most recently evaluated expression's result
        </td>
      </tr>
      <tr>
        <td> _error </td>
        <td>
          - returns the last seen (thrown) error
          <span id="browserSupport" title="updated : 2019-09-05">
            <span><i class="fab fa-node-js"></i> 9.8</span>
          </span>
        </td>
      </tr>
      <tr>
        <td>|</td>
        <td></td>
      </tr>
      <tr>
        <td> .load <strong>file|URL</strong> </td>
        <td>
          - loads the targeted file into the current REPL session
        </td>
      </tr>
      <tr>
        <td> .save <strong>file|URL</strong> </td>
        <td>
          - saves the current REPL session to the targeted file
        </td>
      </tr>
      <tr>
        <td>|</td>
        <td></td>
      </tr>
      <tr>
        <td> .editor </td>
        <td>
          - enter editor mode (multiline expressions can be typed) (<mark style="background-color:lightskyblue;">Ctrl + D</mark> = finish | <mark style="background-color:lightskyblue;">Ctrl + C</mark> = cancel)
        </td>
      </tr>
      <tr>
        <td>|</td>
        <td></td>
      </tr>
      <tr>
        <td colspan="2"> Key Combinations </td>
      </tr>
      <tr>
        <td> Ctrl + C </td>
        <td>
          - <u>one press</u> = abort further input or processing (same as <mark>.break</mark> command) | <u>second press</u> = exit REPL (same as <mark>.exit</mark> command)
        </td>
      </tr>
      <tr>
        <td> Ctrl + D </td>
        <td>
          - closes the I/O stream, causing REPL to exit (same as <mark>.exit</mark> command)
        </td>
      </tr>
      <tr>
        <td> Tab </td>
        <td>
          - displays global and local scope variables
        </td>
      </tr>
    </table>
    <br>
    <table class="table">
      <caption>
        Methods and Events
        <span class="changeListOrder">[Ordered: <span>Alphabetically</span>]</span>
      </caption>
      <tr>
        <th style="width:30%;"> Method / Event </th>
        <th> Description </th>
      </tr>
      <tr>
        <td>
          <strong>repl</strong>.start(<a href="https://nodejs.org/docs/latest/api/repl.html#replstartoptions" target="_blank">option:obj</a>)
        </td>
        <td>
          - creates and returns a <strong>replServer</strong> instance and launches REPL
        </td>
      </tr>
      <tr>
        <td>|</td>
        <td></td>
      </tr>
      <tr>
        <td> <strong>replServer</strong>.context </td>
        <td>
          - holds the properties of the current replServer (this is where we can add properties and methods to the REPL environment)
        </td>
      </tr>
      <tr>
        <td>|</td>
        <td></td>
      </tr>
      <tr>
        <td>
          <strong>replServer</strong>.defineCommand(<strong>cmd:str</strong>, <strong>fn</strong>) <br>
          <strong>replServer</strong>.defineCommand(<strong>cmd:str</strong>, <a href="https://nodejs.org/docs/latest/api/repl.html#replserverdefinecommandkeyword-cmd" target="_blank">option:obj</a>) </td>
        <td>
          - defines a custom REPL command (function called in REPL when <mark>.<strong>cmd</strong></mark> entered)
        </td>
      </tr>
      <tr>
        <td>|</td>
        <td></td>
      </tr>
      <tr>
        <td> <strong>replServer</strong>.displayPrompt(<i class="openable">preserveCursor:bol</i>) </td>
        <td>
          - display the prompt (basically writes the prompt to stdout)
        </td>
      </tr>
      <tr>
        <td> <strong>replServer</strong>.clearBufferedCommand() </td>
        <td>
          - clears the input buffer (ex: when the user entered some characters this method clears that out)
          <span id="browserSupport" title="updated : 2019-09-05">
            <span><i class="fab fa-node-js"></i> 9.0.0 </span>
          </span>
        </td>
      </tr>
      <tr>
        <td>|</td>
        <td></td>
      </tr>
      <tr>
        <td> <strong>replServer</strong>.setupHistory(<strong>file|URL</strong>, <strong>fr(err, replServer)</strong>) </td>
        <td>
          - sets up a command history <br>
          - history log file = data never overridden, new data added on top
          <span id="browserSupport" title="updated : 2019-09-05">
            <span><i class="fab fa-node-js"></i> 11.10.0 </span>
          </span>
        </td>
      </tr>
      <tr>
        <td>|</td>
        <td></td>
      </tr>
      <tr>
        <td colspan="2"> Events </td>
      </tr>
      <tr>
        <td> <strong>replServer.listener</strong>('exit', <strong>fn</strong>) </td>
        <td>
          - event emitted when this REPL instance exit
        </td>
      </tr>
      <tr>
        <td> <strong>replServer.listener</strong>'reset', <strong>fn(replContext)</strong>) </td>
        <td>
          - event emitted when the repl context resets (when the <mark>.clear</mark> command is received)
        </td>
      </tr>
    </table>
    <h2 class="headerSection"> Notes : </h2>
    
    <h2 class="headerSection"> Useful Links : </h2>
    <p><a href="https://nodejs.org/docs/latest/api/repl.html" target="_blanc">Node.js REPL (nodejs.org)</a></p>
    <h2 class="headerSection"> Remember This : </h2>
    <p> - in REPL all Node.js built-in modules available without calling them (like <mark>os</mark>, <mark>assert</mark>, ect...) </p>
    <h2 class="headerSection"> Description and Demonstration : </h2>
    <p> - REPL (<b>R</b>ead <b>E</b>val <b>P</b>rint <b>L</b>oop) is a JavaScript runtime environment within Node.js (like the console in the browser), it is used to run and test JS code </p>
    <p> - REPL is available as standalone program (can be launched with a simple <mark>node</mark> command) but we can also create our own REPL server with custom commands, etc... </p>
    <pre class='cmd'>
    PS D:\safe\code +\my site\03 improuve\learn webdesign\04 node.js\repl> node     // launches REPL
      <optval>...</optval>
    </pre>
    <pre style="margin-bottom:0;">
// myRepl.mjs ----------------------------------------
    import repl from 'node:repl';
    
    global.x = 21;                                      // global varialbes are available in REPL
    
    const replServer = repl.start({ prompt: '> ' });    // trigger REPL (with custom prompt)
    
    replServer.context.y = 22;                          // setup REPL context
    replServer.defineCommand('say', (word) => {         // define custom command
      replServer.displayPrompt();                       // display prompt before the output
      console.log(`I say ${word}`);
    });
    </pre>
    <pre class='cmd' style="margin-top:0;">
    PS D:\safe\code +\my site\03 improuve\learn webdesign\04 node.js\repl> node myRepl.mjs     // launches REPL
      <optval>...</optval>
    </pre>
    <!------------------------------------------------------------------------------------------------------------------------>
    <hr>
    <h2 class="headerExtra"><u> Commands and Key Combinations in REPL </u></h2>
    <h3 style="color:darkblue;"><u> The <mark>.help</mark> / <mark>.exit</mark> / <mark>.clear</mark> / <mark>.editor</mark> / <mark>.break</mark> / <mark>_</mark> / <mark>_error</mark> / <mark>.load</mark> / <mark>.save</mark> commands and <mark>Ctrl + C</mark> / <mark>Ctrl + D</mark> / <mark>Tab</mark> key combinations </u></h3>
    <details class="example">
      <summary> DEMO </summary>
      <pre class="cmd">
    PS D:\safe\code +\my site\03 improuve\learn webdesign\04 node.js\repl\03 .save .load TEST> node                  
        Welcome to Node.js v12.4.0.
        Type ".help" for more information.
// .help ------------------------------------------------------------------------
        > .help                                                                  // prints available commands 
        .break    Sometimes you get stuck, this gets you out
        .clear    Alias for .break
        .editor   Enter editor mode
        .exit     Exit the repl
        .help     Print this help message
        .load     Load JS from a file into the REPL session
        .save     Save all evaluated commands in this REPL session to a file                                                     
        
// .editor ----------------------------------------------------------------------
        > .editor                                                                // editor mode allows to type multiline code within REPL 
        // Entering editor mode (^D to finish, ^C to cancel)
        var add = function(a, b){
          return a + b;
        }                                                                        // Ctrl + D pressed here 
        > add(2, 2);                                                             // above multiline code executed 
        4
        
// .clear -----------------------------------------------------------------------   
        > .clear                                                                 // !! this clears the curent REPL context (REPL scope) but only if REPL is launched by a Node.js process (what is not the case here!)   
        > add(2, 2);                                                             // -! REPL scope not cleared (because REPL runs as standalone program)   
        4
        
// .load / .save ----------------------------------------------------------------
        > .load test.js                                                          // loads the targeted script in the current REPL session 
        var myVar = 11;                                                          // -> loaded script 
        > myVar                                                                  // loaded script available 
        11
        > .save myScript.js                                                      // save the current REPL session (scope) in the targeted file   
        
// _ / _error -------------------------------------------------------------------
        > throw new SyntaxError('some error');
        Thrown:
        SyntaxError: some error
        > _                                                                      // returns the last expression 
        11
        > _error                                                                 // returns the last thrown error 
        [SyntaxError: some error]
    
// .exit ------------------------------------------------------------------------
        > .exit                                                                  // exit REPL 
        PS D:\safe\code +\my site\03 improuve\learn webdesign\04 node.js\repl\03 .save .load TEST>
    </pre>
    </details>
    <!------------------------------------------------------------------------------------------------------------------------>
    <hr>
    <h2 class="headerExtra"><u> Methods and Events </u></h2>
    <h3 style="color:darkblue;"><u> Methods <mark>start()</mark> / <mark>context</mark> / <mark>defineCommand()</mark> / <mark>displayPrompt()</mark> / <mark>clearBufferedCommand()</mark> / <mark>setupHistory()</mark> </u></h3>
    <details class="example">
      <summary> DEMO </summary>
      <pre>
    const repl = require('repl');
    
// start() / context ------------------------------------------------------------
    var replServer = repl.start('> ');                                           // returns a replServer instance and launches REPL on the command line   
    
    replServer.context.data1 = 'some data';                                      // data will be available in this REPL session 
    replServer.context.add = function(a, b) { return a + b; }
    
// defineCommand() / displayPrompt() / clearBufferedCommand() -------------------
    replServer.defineCommand('cmd1', function(arg){                              // 'cmd1' command defined (called as <mark>.cmd1</mark> in REPL)
        replServer.displayPrompt();                                              // display prompt before output
        console.log( arg );
    });
    
    replServer.defineCommand('cmd2', {                                           // 'cmd2' command defined (called as '.cmd2' in REPL)
        help: 'command 2 instructions',
        action() { 
            replServer.clearBufferedCommand();
            replServer.displayPrompt();
        }
    });
    
// setUpHistory() ---------------------------------------------------------------
    replServer.setupHistory('repl_log.txt', function(err, replServer) {           // this REPL history will be saved in 'repl_log.txt' 
        err                                                                      // error in case of error thrown ('null' if not)   
        replServer                                                               // current replServer instance 
    });
    </pre>
    </details>
    <!------------------------------------------------------------------------------------------------------------------------>
    <hr>
    <h3 style="color:darkblue;"><u> Events <mark>exit</mark> / <mark>reset</mark> </u></h3>
    <details class="example">
      <summary> DEMO </summary>
      <pre>
    const repl = require('repl');
     
    var replServer = repl.start('> ');
     
    replServer.on('exit', function(){});                                         // listener function invoked when this REPL session exits   
    replServer.on('reset', function(ctx){                                        // listener function invoked when this REPL session restarts (.clear command entered in REPL)        
        ctx                                                                      // context of this REPL session ('replServer.context')
    });                                            
    </pre>
    </details>

    <br><br>
  </body>
</html>