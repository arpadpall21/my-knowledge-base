<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title> Timers </title>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link rel="stylesheet" href="../../Assets/stylesPages.css">
    <script src="../../Assets/scriptPages.js"></script>
  </head>
  <body>
    <h1> Timers </h1>
    <p> Updated: ( 2019-07-24 / 2025-03-21 )</p>
    <nav class="sitenav">
      <a href="../../index.html">MySite > </a>
      <a href="../index.html">Node.js > </a> Timers
    </nav>
    <table class="table">
      <tr>
        <th style="width:30%;"> Method </th>
        <th> Description </th>
      </tr>
      <tr>
        <td colspan="2"> Timers </td>
      </tr>
      <tr>
        <td> setImmediate(<strong>fn</strong><i>, arg, ...</i>) </td>
        <td>
          - immediately executes <reqval>fn</reqval> after the main thread and after any I/O event <br>
          - returns a unique <strong>immediate</strong> object which is used to control <u>this</u> timer
        </td>
      </tr>
      <tr>
        <td>
          setTimeout(<strong>fn</strong>, <strong class="openable">delayMs:nr<div>
              <p> - milliseconds (from <mark>1</mark> to <mark>2147483647</mark>, offset will be <mark>1</mark>) </p>
            </div></strong><i>, arg, ...</i>) </td>
        <td>
          - executes <reqval>fn</reqval> after the specified time (<strong>delayMs:nr</strong>)<br>
          - returns a unique <strong>timeout</strong> object which is used to control <u>this</u> timer
        </td>
      </tr>
      <tr>
        <td> setInterval(<strong>fn</strong>, <strong class="openable">delayMs:nr<div>
              <p> - milliseconds (from <mark>1</mark> to <mark>2147483647</mark>, offset will be <mark>1</mark>) </p>
            </div></strong><i>, arg, ...</i>) </td>
        <td>
          - executes <reqval>fn</reqval> every set time (<strong>delayMs:nr</strong>)<br>
          - returns a unique <strong>timeout</strong> object which is used to control <u>this</u> timer
        </td>
      </tr>
      <tr>
        <td>|</td>
        <td></td>
      </tr>
      <tr>
        <td> clearImmediate(<strong>immediate:obj</strong>) </td>
        <td> - cancels the immediate timer referenced by the <strong>immediate</strong> object
        </td>
      </tr>
      <tr>
        <td> clearTimeout(<strong>timeout:obj</strong>) </td>
        <td> - cancels the timeout timer referenced by the <mark>timeout</mark> object
        </td>
      </tr>
      <tr>
        <td> clearInterval(<strong>timeout:obj</strong>) </td>
        <td> - cancels the interval timer referenced by the <mark>timeout</mark> object
        </td>
      </tr>
      <tr>
        <td>|</td>
        <td></td>
      </tr>
      <tr>
        <td colspan="2"> timer control methods </td>
      </tr>
      <tr>
        <td>
          <strong>immediate|timeout</strong>.unref()<br>
        </td>
        <td>
          - removes the timer from the event loop (so the Node.js process can exit without waiting to this timer) <br>
          - returns the <strong>immediate|timeout</strong> object
          <span id="browserSupport" title="updated : 2019-07-30">
            <span><i class="fab fa-node-js"></i> 9.7.0 <reqval>immediate</reqval></span>
          </span>
        </td>
      </tr>
      <tr>
        <td>
          <strong>immediate|timeout</strong>.ref() <br>
        </td>
        <td>
          - (re)attaches the timer to the event loop (so the Node.js process will wait till this timer ends) <br>
          - returns the <strong>immediate|timeout</strong> object
          <span id="browserSupport" title="updated : 2019-07-30">
            <span><i class="fab fa-node-js"></i> 9.7.0 <reqval>immediate</reqval></span>
          </span>
        </td>
      </tr>
      <tr>
        <td>
          <strong>immediate|timeout</strong>.hasRef()<br>
        </td>
        <td>
          - returns <mark>true</mark> if the timer is in the event loop, otherwise returns <mark>false</mark>
          <span id="browserSupport" title="updated : 2019-07-30">
            <span><i class="fab fa-node-js"></i> 11.0.0 </span>
          </span>
        </td>
      </tr>
      <tr>
        <td>|</td>
        <td></td>
      </tr>
      <tr>
        <td> <strong>timeout</strong>.refresh() </td>
        <td>
          - restarts this timer <br>
          - restarts an already expired timer <br>
          - returns the <strong>timer</strong> object
          <span id="browserSupport" title="updated : 2019-07-30">
            <span><i class="fab fa-node-js"></i> 10.2.0 </span>
          </span>
        </td>
      </tr>
    </table>
    <br>
    <table class="table">
      <caption>
        Promises API
      </caption>
      <tr>
        <th style="width:30%;"> Method </th>
        <th> Description </th>
      </tr>
      <tr>
        <td>
          <reqval>timersPromises</reqval>.setImmediate(<reqval>val:any</reqval> <a href="https://nodejs.org/docs/latest/api/timers.html#timerspromisessetimmediatevalue-options" target="_blank">options:obj</a>)
        </td>
        <td>
          - returns a <reqval>promise</reqval> that immediately resolves with <reqval>val</reqval>
          <span id="browserSupport" title="updated : 2025-03-21">
            <span><i class="fab fa-node-js"></i> 15 </span>
          </span>
        </td>
      </tr>
      <tr>
        <td>
          <reqval>timersPromises</reqval>.setTimeout(<reqval>delayMs:nr</reqval>, <reqval>val:any</reqval> <a href="https://nodejs.org/docs/latest/api/timers.html#timerspromisessettimeoutdelay-value-options" target="_blank">options:obj</a>)
        </td>
        <td>
          - returns a <reqval>promise</reqval> that resolves after <reqval>delayMs</reqval> with <reqval>val</reqval>
          <span id="browserSupport" title="updated : 2025-03-21">
            <span><i class="fab fa-node-js"></i> 15 </span>
          </span>
        </td>
      </tr>
      <tr>
        <td>
          <reqval>timersPromises</reqval>.setInterval(<reqval>delayMs:nr</reqval>, <reqval>val:any</reqval> <a href="https://nodejs.org/docs/latest/api/timers.html#timerspromisessetintervaldelay-value-options" target="_blank">options:obj</a>)
        </td>
        <td>
          - returns an async interator that generates <reqval>val</reqval> every <reqval>delayMs</reqval>
          <span id="browserSupport" title="updated : 2025-03-21">
            <span><i class="fab fa-node-js"></i> 15.9 </span>
          </span>
        </td>
      </tr>
    </table>
    <h2 class="headerSection"> Notes : </h2>

    <h2 class="headerSection"> Useful Links : </h2>
    <p><a href="https://nodejs.org/docs/latest/api/timers.html" target="_blank"> Node.js Timers (nodejs.org) </a></p>
    <h2 class="headerSection"> Remember This : </h2>

    <h2 class="headerSection"> Description and Demonstration : </h2>
    <p> - the Node.js timer API provides a mechanism to schedule function calls in the future </p>
    <p> - unlike in the browser in Node.js timers are built around the event loop </p>
    <p> - Node.js does not guarantee the exact timing nor the the execution order of timer callbacks, but executes as close as possible to the specified time (because of the event loop mechanism) </p>
    <p class="indent-lv1"> - the counter starts as soon as the timer statement is executed (not after the main thread) but the callback function is still executed after the main thread </p>
    <h3 class="header"> The <mark>setImmediate()</mark> / <mark>setTimeout()</mark> / <mark>setInterval()</mark> / <mark>clearImmediate()</mark> / <mark>clearTimeout()</mark> / <mark>clearInterval()</mark> methods </h3>
    <details class="example">
      <summary> DEMO </summary>
      <pre>
// setImmediate() / clearImmediate() -------------------------------------------
    var immediate = setImmediate(() => {});                                     // callback function immediately called after the main thread  
    var immediate2 = setImmediate(() => {});
    
    clearImmediate(immediate);                                                  // -! the returned 'Immediate' obects are uniqe so this cancels only the first timer   
    
    
// setTimeout() / clearTimeout() -----------------------------------------------
    var timeout = setTimeout(() => {}, 1500);                                   // callback function is called after 1500 milliseconds (1 and a half second)   
    
    clearTimeout(timeout);                                                      // cancels the timeout timer   
    
    
// setInterval() / clearInteral() ----------------------------------------------
    var interval = setInterval(() => {}, 1500);                                 // callback function is called every 1500 milliseconds (1 and a half second)
    
    clearInterval(interval);                                                    // cancels the interval timer 
    // clearTimeout(interval);                                                  // -! this would do the same as the 'clearInterval()' above (so basically they do the same thing)   
      </pre>
    </details>
    <hr>
    <!--------------------------------------------------------------------------------------------------------------------->
    <h3 class="header"> The <mark>unref()</mark> / <mark>ref()</mark> / <mark>hasRef()</mark> / <mark>refresh()</mark> methods </h3>
    <details class="example">
      <summary> DEMO </summary>
      <pre>
    var timeout = setTimeout(function(){ }, 5000);
    
// unRef() / ref() / hasRef() --------------------------------------------------
    timeout.hasRef();                                                           // -> true              // by default all timers are referenced to the Node.js event loop       
    
    timeout.unref();                                                            // -> Timeout {}        // removes (unreferences) the timer from the event loop and returns the timer object   
    timeout.hasRef();                                                           // -> false             // this confirms that the timer is removed from the event loop   
    
    timeout.ref();                                                              // -> Timeout {}        // reataches (references) the timer to the event loop and returns the timer object   
    timeout.hasRef();                                                           // -> true              // this confirms that the timer is in the event loop again 
    
// refresh() -------------------------------------------------------------------
    timeout.refresh();                                                          // -> Timeout {}        // the 5 seconds are basically restarted here (if the timer would be expired by now this would reactivate it)   
    </pre>
    </details>
    <hr>
    <!--------------------------------------------------------------------------------------------------------------------->
    <h2 class="headerExtra"> Promises API </h2>
    <p> - promise timers apis use <mark>AbortSignal</mark> to abort a timeout </p>
    <pre>
    import { setInterval } from 'node:timers/promises';
    
    const abortSignal = AbortSignal.timeout(5000);                // abort signal in 5 sec
    
    for await (const i of setInterval(1000, 'Hello World!', { signal: abortSignal })) {
      i;
    }
    </pre>
    <hr>
    <!--------------------------------------------------------------------------------------------------------------------->
    <h3 class="header"> The promise API <mark>setImmediate()</mark> / <mark>setTimeout()</mark> / <mark>setInterval()</mark> promises </h3>
    <details class="example">
      <summary> Example : </summary>
      <pre>
    import { setImmediate, setTimeout, setInterval } from 'node:timers/promises';
    
// setImmediate() -------------------------
    await setImmediate('Hello World');            // promise immediately resolves 
    
// setTimeout() ---------------------------
    await setTimeout(3000, 'Hello World');        // promise resolves after 3 sec
    
// setInterval() ---------------------------
    for await (const i of setInterval(1000, 'Hello World!')) {    // async interator generates 'Hello World!' every 1 sec
      i;                                              // -> 'Hello World!' | ... 
    }
      </pre>
    </details>

    <br><br>
  </body>
</html>