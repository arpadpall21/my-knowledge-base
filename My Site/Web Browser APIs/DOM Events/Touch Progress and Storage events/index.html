<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title> Touch / Progress / Storage Events </title>    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="styles.css">
    <link rel="stylesheet" href="../../../Assets/stylesPages.css">
    <script src="../../../Assets/scriptPages.js"></script>
</head>
<body>
<h1> Touch / Progress / Storage Events (ver 2.9) </h1>
    <p> Updated ( 2018-10-10 / 2019-03-04 )</p>
    <p class="sitenav"> <a href="../../../index.html">MySite></a>
        <a href="../../index.html"> Web Browser APIs> </a> 
        <a href="../index.html"> DOM Events> </a> Touch / Progress / Storage Events 
    </p>
<table class="table">
<caption> TOUCH EVENTS <span style="color:yellow;">(NOT TESTED 2018-04-02)</span> </caption>
    <tr>
        <th> Event </th>
        <th> Description </th>
    </tr>
    <tr>
        <td> touchcancel </td>
        <td> fires when the touch is interrupted </td>
    </tr>  		 	
	<tr>
        <td> touchend </td>
        <td> fires when a finger is removed from a touch screen </td>
    </tr> 
    <tr>
        <td> touchmove </td>
        <td> fires when a finger is dragged across the screen </td>
    </tr> 
    <tr>
        <td> touchstart </td>
        <td> fires when a finger is placed on a touch screen </td>
    </tr> 
</table><br>
<table class="table">    
<caption> PROGRESS EVENTS </caption>
    <tr>
        <th> Event </th>
        <th> Description </th>
    </tr>
    <tr>
        <td> <prot>Object.Event.ProgressEvent</prot> </td>
        <td> progress event prototype chain </td>
    </tr>
    <tr>
        <td> abort </td>
        <td> fires when the loading process is aborted </td>
    </tr>
    <tr>
        <td> error </td>
        <td> fires when an error occurs during the loading process </td>
    </tr>
    <tr>
        <td> load </td>
        <td> fires at the end of the loading process <u>if it is successful</u> </td>
    </tr>
    <tr>
        <td> loadend </td>
        <td> fires when the loading progress has ended (even if the progress fails) </td>
    </tr>
    <tr>
        <td> loadstart </td>
        <td> fires when the loading progress has begun </td>
    </tr>
    <tr>
        <td> progress </td>
        <td> occurs when loading external resources (<u>fires repeatedly</u> until the resource is finished loading) (fires after the "loadstart" event) </td>
    </tr>
    <tr>
        <th colspan="2" style="color:black; font-weight:normal;"> properties </th>
    </tr>
    <tr>
        <td> <strong>eventObj</strong>.lengthComputable </td>
        <td> returns a boolean value indicating if the length of the progress can be computed </td>
    </tr> 
    <tr>
        <td> <strong>eventObj</strong>.loaded </td>
        <td> returns a number indicating how much work is done out of the total progress (not percentage) </td>
    </tr> 
    <tr>
        <td> <strong>eventObj</strong>.total </td>
        <td> returns a number indicating the total amount of progress </td>
    </tr> 
</table><br>


<table class="table">    
<caption> STORAGE EVENT </caption>
    <tr>
        <th> Event </th>
        <th> Description </th>
    </tr>
    <tr>
        <td> storage </td>
        <td> fires when the local storage is updated <u>in an other window than itself</u> <span style="color:orangered;">(poor browser support [2018-10-11]) (works only with the <mark>localStorage</mark> object)</span> </td>
    </tr>  
    <tr>
        <th colspan="2" style="color:black; font-weight:normal;"> properties </th>
    </tr>    <tr>
        <td> <strong>eventObj</strong>.key </td>
        <td> returns the keys that are changed in the storage </td>
    </tr>
    <tr>
        <td> <strong>eventObj</strong>.newValue </td>
        <td> returns the new values </td>
    </tr>
    <tr>
        <td> <strong>eventObj</strong>.oldValue </td>
        <td> returns the old values of the changed values </td>
    </tr>
    <tr>
        <td> <strong>eventObj</strong>.storageArea </td>
        <td> returns the storage object itsleft for changed storage item </td>
    </tr>
    <tr>
        <td> <strong>eventObj</strong>.url </td>
        <td> returns the URL of the changed item's document </td>
    </tr>
</table>    
<h2 style="color:green;"><u> Useful Links : </u></h2> 
    <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/TouchEvent" target="_blank"> MDN Touch Events </a></p>
    <p><a href="https://www.w3schools.com/jsref/obj_touchevent.asp" target="_blank"> W3Schools Touch Events </a></p>
    <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/ProgressEvent" target="_blank"> MDN Progress Events </a></p>
    <p><a href="https://www.w3schools.com/jsref/obj_progressevent.asp" target="_blank"> W3Schools Progress Events </a></p>
    <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/StorageEvent" target="_blank"> MDN Storage Event </a></p>
    <p><a href="https://www.w3schools.com/jsref/obj_storageevent.asp" target="_blank"> W3Schools Storage Event </a></p>    
<h2 style="color:green;"><u> Remember This : </u></h2> 
    <p> - for some strange reason this event fires only for the <mark>localStorage</mark> object and <u>on windows other than the global scope!!</u></p>
<h2 style="color:green;"><u> Description and Demonstration : </u></h2>    
<h2 class="headerExtra"><u> <mark>TouchEvent()</mark></u></h2>    
    <p style="color:yellow;"> - the <mark>TouchEvent()</mark> is not tested because I cannot generate touch events now (2018-10-10) </p>
    <pre class="syntax">
SYNTAX :    touchcancel                 // fires when the touch is interrupted
            touchend                    // fires when a finger is removed from a touch screen
            touchmove                   // fires when a finger is dragged across the screen
            touchstart                  // fires when a finger is placed on a touch screen
    </pre>
<details class="example">
    <summary> Example : </summary>
<h4><u> red circle arround fingers on touchscreen (source: Eloquent JavaScript) [Not Tested! (2018-10-13)] </u></h4>
<script>
    window.addEventListener("touchstart", update);
    window.addEventListener("touchmove", update);
    window.addEventListener("touchend", update);
    
    function update(event) {
        for (let dot; dot = document.querySelector("dot");) {
            dot.remove();
        }
        for (let i = 0; i < event.touches.length; i++) {
            let {pageX, pageY} = event.touches[i];
            let dot = document.createElement("dot");
            dot.style.left = (pageX - 50) + "px";
            dot.style.top = (pageY - 50) + "px";
            document.body.appendChild(dot);
        }
    }
</script>
        <details>
        <summary class="exampleCode"> CODE : </summary>
        <pre>
&lt;script&gt;
    window.addEventListener("touchstart", update);
    window.addEventListener("touchmove", update);
    window.addEventListener("touchend", update);
    
    function update(event) {
        for (let dot; dot = document.querySelector("dot");) {
            dot.remove();
        }
        for (let i = 0; i &lt; event.touches.length; i++) {
            let {pageX, pageY} = event.touches[i];
            let dot = document.createElement("dot");
            dot.style.left = (pageX - 50) + "px";
            dot.style.top = (pageY - 50) + "px";
            document.body.appendChild(dot);
        }
    }
&lt;/script&gt;    
    
    -- CODE (CSS) --
    dot { 
        position: absolute; 
        display: block;
        border: 2px solid red; 
        border-radius: 50px;
        height: 100px; 
        width: 100px; 
    }
        </pre>
        </details>
</details>    
<!------------------------------------------------------------------------------------------------------------------------------>
<hr>
<h2 class="headerExtra"><u> <mark>ProgressEvent()</mark> </u></h2>    
    <p style="color:yellow;"><u> - tested with the File API but it works the same way with Ajax ect... </u></p>
    <pre class="syntax">
SYNTAX :    progress                    // occurs when loading external resources (<u>fires repeatedly</u> until the resource is finished loading) (fires after the "loadstart" event)   
            loadstart                   // fires when the loading progress has begun 
            loadend                     // fires when the loading progress has ended (even if the progress fails)
            load                        // fires at the end of the loading process <u>if it is successful</u>
            abort                       // fires when the loading process is aborted 
            error                       // fires when an error occurs during the loading process 
            
            <strong>eventObj</strong>.lengthComputable  // returns a boolean value indicating if the length of the progress can be computed  
            <strong>eventObj</strong>.loaded            // returns a number indicating how much work is done out of the total progress (not percentage)
            <strong>eventObj</strong>.total             // returns a number indicating the total amount of progress 
    </pre>
    <pre>
    &lt;form id="test"&gt;
        &lt;input type="file"&gt;
    &lt;/form&gt;
&lt;script&gt;
    var fileReaderObj = new FileReader();
    document.getElementById("test").elements[0].onchange = function() {
        fileReaderObj.readAsBinaryString(document.getElementById("test").elements[0].files[0]);     // we start reading the dropped file (this triggers the progress event)  
    }
    
// "onprogress" fires repeatedly until the progress ends ----------------------- 
    fileReaderObj.onprogress = function(e) {                // "e" is the ProgressEvent
        if(e.lengthComputable) {                            // check if the progress can be calculated 
            e.total;                                        // returns the total amount of work to be done 
            e.loaded;                                       // returns the current state of the progress (this is where the "progress" event repetition is very handy)  
        }
    }
// "onloadstart" fires when the progress starts (before the "progress" event) --
    fileReaderObj.onloadstart = function(e) {}              // "e" is the ProgressEvent
    
// "onload" fires at the end of the progress (if successful) ------------------- 
    fileReaderObj.onload = function(e) {}                   // "e" is the ProgressEvent
    
// "onloadend" fires at the end of the progress (no matter if progress fails or it is successful) --
    fileReaderObj.onloadend = function(e) {}                // "e" is the ProgressEvent
   
// "onabort" fires if the progress is aborted ----------------------------------  
    fileReaderObj.onabort = function(e) {}                  // "e" is the ProgressEvent
    
// "onerror" fires if an error occurs during the progress ---------------------- 
    fileReaderObj.onerror = function(e) {}                  // "e" is the ProgressEvent
&lt;/script&gt;
    </pre>
<details class="example">
<summary> Example : </summary>
<h4><u> <mark>progress</mark> event TEST </u></h4>
    <p> - try to load a big file to see the progres bar to fill up </p>
    <form id="progressTest">
        <input type="file">
    </form>
    <button onmouseup="abortLoading()"> Abort </button><br>
    <progress id="progressMeter" max="100" value="0"></progress>
    <p id="loadStatus"> Loading Status : <span style="font-weight:bold;"></span></p>
<script>
    var fileReader = new FileReader();                                                      // file reader obj
    var feedbackmessage = "";
    
    document.getElementById("progressTest").elements[0].onchange = function() {
        var dorppedFile = document.getElementById("progressTest").elements[0].files[0];     // dropped file 
        fileReader.readAsBinaryString(dorppedFile);                                         // we are reading the file here (not retunred see File API)
    }
    
// abort progress
    var abortLoading = function() {
        fileReader.abort();
    }
    
// when file reading starts the "ProgressEvent" kicks in
    fileReader.onprogress = function(e) {                               // repeatedly fires until the loading process ends
        if (e.lengthComputable) {                                       // check if we can calculate the task progress
            document.getElementById("progressMeter").setAttribute("max", e.total);          // total amount of work to be done
            document.getElementById("progressMeter").setAttribute("value", e.loaded);       // current status of the progress 
        }
    }
    fileReader.onloadstart = function(e) {                              // fires at the beginning of the progress (very first event to start)
        feedbackmessage = "Start Reading"
        document.getElementById("loadStatus").firstElementChild.textContent = feedbackmessage;
    }
    fileReader.onload = function(e) {                                   // fires at the end of the progres IF the progress is successful
        feedbackmessage = "Success";
        document.getElementById("loadStatus").firstElementChild.textContent = feedbackmessage;
    }
    fileReader.onerror = function(e) {                                  // fires if the progress fails
        feedbackmessage = "Fail"
        document.getElementById("loadStatus").firstElementChild.textContent = feedbackmessage;
    }
    fileReader.onloadend = function(e) {                                // fires at the end of the progres (even if the progress fails)
        feedbackmessage += " (Reading Ended)"
        document.getElementById("loadStatus").firstElementChild.textContent = feedbackmessage;
    } 
    fileReader.onabort = function(e) {
        feedbackmessage = "Aborted!";
        document.getElementById("loadStatus").firstElementChild.textContent = feedbackmessage;
    }
</script>
        <details>
        <summary class="exampleCode"> CODE : </summary>
        <pre>
    &lt;form id="progressTest"&gt;
        &lt;input type="file"&gt;
    &lt;/form&gt;
    &lt;button onmouseup="abortLoading()"&gt; Abort &lt;/button&gt;&lt;br&gt;
    &lt;progress id="progressMeter" max="100" value="0"&gt;&lt;/progress&gt;
    &lt;p id="loadStatus"&gt; Loading Status : &lt;span style="font-weight:bold;"&gt;&lt;/span&gt;&lt;/p&gt;
&lt;script&gt;
    var fileReader = new FileReader();                                                      // file reader obj
    var feedbackmessage = "";
    
    document.getElementById("progressTest").elements[0].onchange = function() {
        var dorppedFile = document.getElementById("progressTest").elements[0].files[0];     // dropped file 
        fileReader.readAsBinaryString(dorppedFile);                                         // we are reading the file here (not retunred see File API)
    }
    
// abort progress
    var abortLoading = function() {
        fileReader.abort();
    }
    
// when file reading starts the "ProgressEvent" kicks in
    fileReader.onprogress = function(e) {                               // repeatedly fires until the loading process ends
        if (e.lengthComputable) {                                       // check if we can calculate the task progress
            document.getElementById("progressMeter").setAttribute("max", e.total);          // total amount of work to be done
            document.getElementById("progressMeter").setAttribute("value", e.loaded);       // current status of the progress 
        }
    }
    fileReader.onloadstart = function(e) {                              // fires at the beginning of the progress (very first event to start)
        feedbackmessage = "Start Reading"
        document.getElementById("loadStatus").firstElementChild.textContent = feedbackmessage;
    }
    fileReader.onload = function(e) {                                   // fires at the end of the progres IF the progress is successful
        feedbackmessage = "Success";
        document.getElementById("loadStatus").firstElementChild.textContent = feedbackmessage;
    }
    fileReader.onerror = function(e) {                                  // fires if the progress fails
        feedbackmessage = "Fail"
        document.getElementById("loadStatus").firstElementChild.textContent = feedbackmessage;
    }
    fileReader.onloadend = function(e) {                                // fires at the end of the progres (even if the progress fails)
        feedbackmessage += " (Reading Ended)"
        document.getElementById("loadStatus").firstElementChild.textContent = feedbackmessage;
    } 
    fileReader.onabort = function(e) {
        feedbackmessage = "Aborted!";
        document.getElementById("loadStatus").firstElementChild.textContent = feedbackmessage;
    }
&lt;/script&gt;
        </pre>
        </details>
</details>
<!------------------------------------------------------------------------------------------------------------------------------>
<hr>    
<h2 class="headerExtra"><u> <mark>StorageEvent()</mark> </u></h2>    
    <p> - the <mark>StorageEvent()</mark> is derived from the <mark>Event()</mark> constructor </p>
    <p style="color:yellow;"> - it has a very poor browser support (2018-10-11), doesn't work in Chrome in local site, EDGE does not support it, => tested with Mozilla </p>
<!------------------------------------------------------------------------------------------------------------------------------>
<hr>
<h2 style="color:darkblue;"><u> Storage Event </u></h2>    
    <p style="color:yellow;"> - for some strange reason this event fires only for the <mark>localStorage</mark> and <u>on windows other than the global scope!!</u> </p>
    <pre class="syntax">
SYNTAX:     storage                     // fires when the local storage is updated <u>in an other window than itself</u> <span style="color:orange;">(works only with the <mark>localStorage</mark> object)</span> 
    </pre>
<details class="example">  
    <summary> Example : </summary>
<h4><u> <mark>storage</mark> event test </u></h4>
    <p> - tested in Mozilla on local site (2018-10-11) </p>
    <button id="updateStorage_globalScope"> Update local storage in the global scope (does not triger the storage event) </button><br>
    <button id="updateStorage_newWindow"> Update local storage in a new browser window (trigers the storage event) </button><br>
    <p id="storageFeedback"> Local Storage updated = <span style="color:red; font-weight:bold;">NO</span></p>
<script>
// listener set up for the "storage" event    
    window.addEventListener("storage", storageEvent);
    
    function storageEvent(event) {
        document.querySelector("#storageFeedback span").textContent = "YES";
        document.querySelector("#storageFeedback span").style.color = "green";
    }
    
// update local storage on the global scope     (Does not work on the global scope WTF)
    document.getElementById("updateStorage_globalScope").addEventListener("mouseup", globStorage);
    function globStorage(event) {
        window.sessionStorage.setItem("myTime", Date.now());
    }
    
// update local storage on a new window         (storage event fires on a window other then itself)  
    document.getElementById("updateStorage_newWindow").addEventListener("mouseup", newWinStorage);
    function newWinStorage(event) {
        var x = window.open("", "myWindow", "width=400,height=300");
        x.localStorage.setItem("thisTime", Date.now());
        x.close();
    }
</script>
        <details>
        <summary class="exampleCode"> CODE : </summary>
        <pre>
    &lt;button id="updateStorage_globalScope"&gt; Update local storage in the global scope (does not triger the storage event) &lt;/button&gt;&lt;br&gt;
    &lt;button id="updateStorage_newWindow"&gt; Update local storage in a new browser window (trigers the storage event) &lt;/button&gt;&lt;br&gt;
    &lt;p id="storageFeedback"&gt; Local Storage updated = &lt;span style="color:red; font-weight:bold;"&gt;NO&lt;/span&gt;&lt;/p&gt;
&lt;script&gt;
// listener set up for the "storage" event    
    window.addEventListener("storage", storageEvent);
    
    function storageEvent(event) {
        document.querySelector("#storageFeedback span").textContent = "YES";
        document.querySelector("#storageFeedback span").style.color = "green";
    }
    
// update local storage on the global scope     (Does not work on the global scope WTF)
    document.getElementById("updateStorage_globalScope").addEventListener("mouseup", globStorage);
    function globStorage(event) {
        window.sessionStorage.setItem("myTime", Date.now());
    }
    
// update local storage on a new window         (storage event fires on a window other then itself)  
    document.getElementById("updateStorage_newWindow").addEventListener("mouseup", newWinStorage);
    function newWinStorage(event) {
        var x = window.open("", "myWindow", "width=400,height=300");
        x.localStorage.setItem("thisTime", Date.now());
        x.close();
    }
&lt;/script&gt;    
        </pre>
        </details>
</details>    
<!------------------------------------------------------------------------------------------------------------------------------>
<hr>    
<h2 style="color:darkblue;"><u> Storage Event Properties </u></h2>    
    <pre class="syntax">
SYNTAX :    <strong>eventObj</strong>.key                // returns the keys what are changed in the storage 
            <strong>eventObj</strong>.newValue           // returns the new values 
            <strong>eventObj</strong>.oldValue           // returns the old values of the changed values
            <strong>eventObj</strong>.storageArea        // returns the storage object itsleft for changed storage item
            <strong>eventObj</strong>.url                // returns the URL of the changed item's document
    </pre>
    <pre>
&lt;script&gt;
// storage listener
    window.onstorage = function(event) {
        event.key;                      // -> "randoKey"                        // the changed storage key 
        event.newValue;                 // -> 45                                // the cahnged new value
        event.oldValue;                 // -> 75                                // the old value what is changed now
        event.url                       // -> about:blank                       // Tested (online and local pages) returns this value in every situation
        event.storageArea               // -> Storage {randomKey:"randomKey"}   // returns the storage object itself
    }
    
// create another window and update the local storage of it (random number generated in order to get a new value every time)
    var myWindow = window.open("", "myWindow", "width=500, height=300");
    myWindow.localStorage.setItem("randomKey", Math.floor(Math.random() * 100));    <span style="color:orangered;">&lt;- does Not work with the "sessionStorage" object for some reasons </span>
&lt;/script&gt;    
    </pre>
<details class="example">    
    <summary> Example : </summary>
<h4><u> <mark>key</mark> / <mark>newValue</mark> / <mark>oldValue</mark> / <mark>storageArea</mark> / <mark>url</mark> </u></h4>    
    <button onmousedown="windowStorage(event)"> Open new Window and update localstorage </button>
<script>
// storage listener    
    window.addEventListener("storage", storageListener);
    function storageListener(event) {
        console.log( "Changed key : " + event.key );
        console.log( "Old Value : " + event.oldValue);
        console.log( "New Value : " + event.newValue);
        console.log( "URL : " + event.url);
        console.log( "Storage Area :" );
            console.log( event.storageArea );
        console.warn("-----------------");
    }

// creat a new window and update local storage
    function windowStorage(event) {
        var myWindow = window.open("", "myWindow", "width=500, height=400");
        myWindow.localStorage.setItem("key1", Date.now());              // we change the value each time in order to update a new value
        myWindow.localStorage.setItem("key2", Date()); 
        myWindow.close();
    }
</script>
        <details>
        <summary class="exampleCode"> CODE : </summary>
        <pre>
    &lt;button onmousedown="windowStorage(event)"&gt; Open new Window and update localstorage &lt;/button&gt;
&lt;script&gt;
// storage listener    
    window.addEventListener("storage", storageListener);
    function storageListener(event) {
        console.log( "Changed key : " + event.key );
        console.log( "Old Value : " + event.oldValue);
        console.log( "New Value : " + event.newValue);
        console.log( "URL : " + event.url);
        console.log( "Storage Area :" );
            console.log( event.storageArea );
        console.warn("-----------------");
    }

// creat a new window and update local storage
    function windowStorage(event) {
        var myWindow = window.open("", "myWindow", "width=500, height=400");
        myWindow.localStorage.setItem("key1", Date.now());              // we change the value each time in order to update a new value
        myWindow.localStorage.setItem("key2", Date()); 
        myWindow.close();
    }
&lt;/script&gt;    
        </pre>    
        </details>
</details>    
    
    <br><br>
</body>
</html>