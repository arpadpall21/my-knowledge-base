<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title> Cookies </title>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link rel="stylesheet" href="../../Assets/stylesPages.css">
    <script src="../../Assets/scriptPages.js"></script>
  </head>
  <body>
    <h1> Cookies </h1>
    <p> Updated ( 2018-02-02 / 2018-12-23 / 2020-07-15 / 2025-03-12 )</p>
    <nav class="sitenav"> <a href="../../index.html">MySite > </a>
      <a href="../index.html"> Web Browser's APIs > </a> Cookies
    </nav>
    <h2 class="headerSection"> Notes : </h2>
    
    <h2 class="headerSection"> Useful Links : </h2>
    <p><a href="https://www.w3schools.com/js/js_cookies.asp" target="_blank"> W3Schools JavaScript Cookies </a></p>
    <h2 class="headerSection"> Remember This : </h2>
    <p> - on local file sites cookies are not working properly (TEST cookies when serving sites from a server) </p>
    <h2 class="headerSection"> Description and Demonstration : </h2>
    <pre class="syntax">
    <em>document</em>.cookie              // returns the document's cookies
    
    <em>document</em>.cookie = "<strong>key</strong>=<strong>value</strong>; <small>[expires=<i class="openable">date<div>
                <p> - expiry date for <u>this cookie </u> (can be generated by the <mark><strong>dateObj</strong>.toUTCString()</mark> method) </p>
                <p> - ex: <mark>Mon, 05 Apr 2021 07:03:14 GMT</mark> </p>
              </div></i>]</small>; <small>[path=<optval class="openable">path<div>
                <p> - path for <u>this cookie </u> (Default: <mark>/</mark> = current page) </p>
                <p> - cookies accessible beyond the set path (ex: <mark>path=/example</mark> = the set cookie can be accessed from any url which starts with <mark>/example</mark>) </p>
              </div></optval>]</small>"    // sets a cookie (and its parameters) to the document
        </pre>
    <p> - cookies are small text datas stored and managed by browser, they are used for 'remembering' things like logins, and spying on clients (each browser controls their own cookies) </p>
    <p> - <u>cookies are stored per domain</u> and deleted when the current network session ends (browser specific) <u>unless a later expiry date is set</u> </p>
    <p> - cookies set to the document will be <u>automatically send with the next request</u> in the <mark>Cookie</mark> <a href="../../HTTP%20Protocol/Header%20Fields/index.html#cookies" target="_blank">[link]</a> request header </p>
    <p> - if the server sends a cookie with the <mark>Set-Cookie</mark> <a href="../../HTTP%20Protocol/Header%20Fields/index.html#cookies" target="_blank">[link]</a> header <u>the browser automatically sets the received cookie to the document</u> </p>
    <p style="color:yellow;"> - if the server sends <mark>HttpOnly</mark> cookies (ex: <mark>Set-Cookie: co=val; HttpOnly</mark>) the font end browser JavaScript cannot see or access it (this way the server can manage cookies on the client's browser without the client's having access to it) </p>
    <details class="example">
      <summary> DEMO </summary>
      <pre>
// get set cookies --------------------------------------------------------------------
    document.cookie;                                                                   // -> returns the document's cookies  
    
    document.cookie = "name=Bircsy;                                                    // sets a cookie key/value pari          // deleted as soon the tab closed    
    document.cookie = "name=Bircsy; expires=Sat, 1 Jan 2020 12:00:00 UTC";             // set cookie + expiry date              // browser kepts it until the specified time   
    document.cookie = "name=Bircsy; expires=Sat, 1 Jan 2020 12:00:00 UTC; path=/";     // set cookie + expiry date + path       // this cookie is accessible form the whole domain    
    document.cookie = "name=Bircsy; expires=Sat, 1 Jan 2020 12:00:00 UTC; path=/this"; // set cookie + expiry date + path       // this cookie can be accessed from any url starting with '/this'    
    
// delete cookies ---------------------------------------------------------------------
    document.cookie = "name=Bircsy; expires=Thu, 01 Jan 1970 00:00:00 GMT";            // deletes the cookie (past time is set) 
    
    document.cookie = " ";                                                             // -! does NOT delete anything instead it adds a new empty space the document's cookies     
    document.cookie = "name=";                                                         // this deletes (sets) ONLY the 'name' cookie's value 
    </pre>
      <!------------------------------------------------------------------------------------------------------->
      <hr>
      <h4 style="color:darkblue;"><u> Client (Browser) / Server cookie exchange </u></h4>
      <p><b> (1) Express Server </b></p>
      <pre>
    const express = require('express');     
    const cookieParser = require('cookie-parser');
    const app = express();
    
    app.use(
        cookieParser(),
        function(req, res, next){ 
            console.log( req.cookies );                                                // -> {}                                       // no cookes with the 1st request 
            
            res.cookie('someCookie', 20);                                              // sending 2 cookies to the client 
            res.cookie('httpOnlyCookie', 21, {httpOnly:true});                         // -! httpOnly cookie is invisible for the front-end JavaScript    
            
            next();
        },
        express.static('../../')
    )
    
    app.listen(1000, ()=>console.log('Express is listening on localhost:1000'));    
    </pre>
      <p><b> (2) Client (Browser) </b></p>
      <pre>
    &lt;script&gt;    
        console.log( document.cookie );                                                // -> 'myCookie=21';                           // cookies set to the document    
                                                                                                                                      // -! httpOnly cookie is not visible here but it was set (can be checked in Chrome devtool 'Application' tab)    
    &lt;/script&gt;
    
    // in the next request to this domain these cookies (someCookie=20 / httpOnlyCookie=21) are sent to the server in the 'Cookie' request header automatically    
    </pre>
      <p><b> (3) Express Server </b></p>
      <pre>
    const express = require('express');     
    const cookieParser = require('cookie-parser');
    const app = express();
    
    app.use(
        cookieParser(),
        function(req, res, next){ 
            console.log( req.cookies );                                                // -> {someCookie:'20', httpOnlyCookie:'21'}   // recieved cookies from the client    
            
            res.cookie('someCookie', 20); 
            res.cookie('httpOnlyCookie', 21, {httpOnly:true});  
            
            next();
        },
        express.static('../../')
    )
    
    app.listen(1000, ()=>console.log('Express is listening on localhost:1000'));    
    </pre>
    </details>
    <details class="example">
      <summary> Example : </summary>
      <form onsubmit="cookieCollect()">
        <input type="text" name="tempCookie" id="tempCookie" autocomplete="off"> Set a temporary cookie (deleted after the browser closed) <br>
        <input type="text" name="1minCookie" id="1minCookie" autocomplete="off"> Set a cookie for 1 minute (deleted after 1 minute)<br>
        <input type="submit" value="Submit">
      </form>
      <button onclick="delCookie_1()"> Delete Temporary Cookie </button>
      <button onclick="delCookie_2()"> Delete 1-minute Cookie </button><br>
      <span style="color:yellow;" id="cookieDisp"> </span>
      <script>
    function cookieCollect() {
        var tempCookie = document.getElementById('tempCookie').value;
        var min1Cookie = document.getElementById('1minCookie').value;
        
        document.cookie = 'formCookie-1=' + tempCookie + "; path=/";
        document.cookie = 'formCookie-2=' + min1Cookie + "; expires=" + new Date( new Date().getTime() + 60 * 1000 ).toUTCString();    
                // this is how you add 1 minute to the time when the browser runs the function 
    }
    function delCookie_1() {
        document.cookie = "formCookie-1=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/";
                // "path=/" set when the cookie is created so we need to add it when deleting
    }
    function delCookie_2() {
        document.cookie = "formCookie-2=; expires=Thu, 01 Jan 1970 00:00:00 UTC";
                // path is not set because when the cookie is created it wasn't set in the first place 
    }
    
    document.getElementById('cookieDisp').innerHTML = "Page Cookies = " + document.cookie.fontcolor('blue');
</script>
      <details>
        <summary class="exampleCode"> CODE : </summary>
        <pre> 
    &lt;button onclick="delCookie_1()"&gt; Delete Temporary Cookie &lt;/button&gt;
    &lt;button onclick="delCookie_2()"&gt; Delete 1-minute Cookie &lt;/button>&lt;br&gt;
    &lt;span style="color:yellow;" id="cookieDisp"&gt; &lt;/span&gt;
&lt;script&gt;
    function cookieCollect() {
        var tempCookie = document.getElementById('tempCookie').value;
        var min1Cookie = document.getElementById('1minCookie').value;
        
        document.cookie = 'formCookie-1=' + tempCookie + "; path=/";
        document.cookie = 'formCookie-2=' + min1Cookie + "; expires=" + new Date( new Date().getTime() + 60 * 1000 ).toUTCString();    
                // this is how you add 1 minute to the time when the browser runs the function 
    }
    function delCookie_1() {
        document.cookie = "formCookie-1=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/";
                // "path=/" set when the cookie is created so we need to add it when deleting
    }
    function delCookie_2() {
        document.cookie = "formCookie-2=; expires=Thu, 01 Jan 1970 00:00:00 UTC";
                // path is not set because when the cookie is created it wasn't set in the first place 
    }
    
    document.getElementById('cookieDisp').innerHTML = "Page Cookies = " + document.cookie.fontcolor('blue');
&lt;/script&gt;
        </pre>
      </details>
      <!------------------------------------------------------------------------------------------------------->
      <hr>
      <h4 style="color:darkblue;"><u> Client (Browser) / Server cookie exchange TEST </u></h4>
      <p><b> (1) Express Server </b></p>
      <pre>
    const express = require('express');     
    const cookieParser = require('cookie-parser');
    const app = express();
    
    app.use(
        cookieParser(),
        function(req, res, next){ 
            console.log( req.cookies );                                                // -> {}                                       // no cookes with the 1st request 
            
            res.cookie('someCookie', 20);                                              // sending 2 cookies to the client 
            res.cookie('httpOnlyCookie', 21, {httpOnly:true});                         // -! httpOnly cookie is invisible for the front-end JavaScript    
            
            next();
        },
        express.static('../../')
    )
    
    app.listen(1000, ()=>console.log('Express is listening on localhost:1000'));    
    </pre>
      <p><b> (2) Client (Browser) </b></p>
      <pre>
    &lt;script&gt;    
        console.log( document.cookie );                                                // -> 'myCookie=21';                           // cookies set to the document    
                                                                                                                                      // -! httpOnly cookie is not visible here but it was set (can be checked in Chrome devtool 'Application' tab)    
    &lt;/script&gt;
    
    // in the next request to this domain these cookies (someCookie=20 / httpOnlyCookie=21) are sent to the server in the 'Cookie' request header automatically    
    </pre>
      <p><b> (3) Express Server </b></p>
      <pre>
    const express = require('express');     
    const cookieParser = require('cookie-parser');
    const app = express();
    
    app.use(
        cookieParser(),
        function(req, res, next){ 
            console.log( req.cookies );                                                // -> {someCookie:'20', httpOnlyCookie:'21'}   // recieved cookies from the client    
            
            res.cookie('someCookie', 20); 
            res.cookie('httpOnlyCookie', 21, {httpOnly:true});  
            
            next();
        },
        express.static('../../')
    )
    
    app.listen(1000, ()=>console.log('Express is listening on localhost:1000'));    
    </pre>
    </details>

    <br><br>
  </body>
</html>