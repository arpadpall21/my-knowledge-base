<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title> Web Workers </title>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link rel="stylesheet" href="../../Assets/stylesPages.css">
    <script src="../../Assets/scriptPages.js"></script>
  </head>
  <body>
    <h1> Web Workers </h1>
    <p> Updated: ( 2018-06-11 / 2020-12-21 / 2025-03-25 )</p>
    <nav class="sitenav"> <a href="../../index.html">MySite > </a>
      <a href="../index.html"> Web Browser APIs > </a> Web Workers
    </nav>
    <table class="table">
      <caption>
        Dedicated Worker <mark>Worker</mark>
        <span class="browserSupport" title="updated : 2020-12-22">
          <span><i class="fab fa-chrome"></i> 4 </span>
          <span><i class="fab fa-firefox"></i> 3.5 </span>
          <span><i class="fab fa-opera"></i> 11.5 </span>
          <span><i class="fab fa-internet-explorer"></i><i class="fab fa-edge"></i> 10 </span>
          <span><i class="fab fa-safari"></i> 4 </span>
        </span>
      </caption>
      <tr>
        <th style="width:30%;"> Method </th>
        <th> Description </th>
      </tr>
      <tr>
        <td>
          new Worker(<strong>url:str</strong>, <a href="https://developer.mozilla.org/en-US/docs/Web/API/Worker/Worker#options" target="_blank">option:obj</a>)
        </td>
        <td> creates and returns a <reqval>dedicatedWorker</reqval> </td>
      </tr>
      <tr>
        <td>|</td>
        <td></td>
      </tr>
      <tr>
        <td> <strong>dedicatedWorker</strong>.postMessage(<strong>msg:any</strong>) </td>
        <td> - sends a message to the Worker </td>
      </tr>
      <tr>
        <td>|</td>
        <td></td>
      </tr>
      <tr>
        <td> <strong>dedicatedWorker</strong>.terminate() </td>
        <td> - terminates|closes the worker </td>
      </tr>
      <tr>
        <td>|</td>
        <td></td>
      </tr>
      <tr>
        <td> <strong>dedicatedWorker</strong>.onmessage = <strong>fn(ev)</strong> </td>
        <td>
          - event fires when a message is received from <strong>dedicatedWorker</strong>
        </td>
      </tr>
      <tr>
        <td> <strong>dedicatedWorker</strong>.onmessageerror = <strong>fn(ev)</strong> </td>
        <td>
          - event fires when the received message cannot be deserialized
          <span class="browserSupport" title="updated : 2025-03-25">
            <span><i class="fab fa-chrome"></i> NO </span>
            <span><i class="fab fa-firefox"></i> 57 </span>
            <span><i class="fab fa-opera"></i> NO </span>
            <span><i class="fab fa-internet-explorer"></i><i class="fab fa-edge"></i> 16.5 </span>
            <span><i class="fab fa-safari"></i> NO </span>
          </span>
        </td>
      </tr>
      <tr>
        <td> <strong>dedicatedWorker</strong>.onerror = <strong>fn(ev)</strong> </td>
        <td>
          - event fires when an error is thrown in the <reqval>dedicatedWorker</reqval>
        </td>
      </tr>
      <tr>
        <td>|</td>
        <td></td>
      </tr>
      <tr>
        <td colspan="2"> (in worker) <a style="background-color:white;" href="https://developer.mozilla.org/en-US/docs/Web/API/DedicatedWorkerGlobalScope" target="_blank">DedicatedWorkerGlobalScope</a> </td>
      </tr>
      <tr>
        <td> postMessage(<strong>msg:any</strong>) </td>
        <td>
          - sends a message to main thread
        </td>
      </tr>
      <tr>
        <td>|</td>
        <td></td>
      </tr>
      <tr>
        <td> close() </td>
        <td> - discards any tasks queued in the <reqval>dedicatedWorker</reqval> event loop, result by closing it </td>
      </tr>
      <tr>
        <td>|</td>
        <td></td>
      </tr>
      <tr>
        <td> onmessage = <strong>fn(ev)</strong> </td>
        <td>
          - event fires when a message is received from the thread that creted this worker
        </td>
      </tr>
      <tr>
        <td> onmessageerror = <strong>fn(ev)</strong> </td>
        <td>
          - event fires when the received message cannot be deserialized
          <span class="browserSupport" title="updated : 2025-03-25">
            <span><i class="fab fa-chrome"></i> 60 </span>
            <span><i class="fab fa-firefox"></i> 57 </span>
            <span><i class="fab fa-opera"></i> 47 </span>
            <span><i class="fab fa-internet-explorer"></i><i class="fab fa-edge"></i> 18 </span>
            <span><i class="fab fa-safari"></i> 16.4 </span>
          </span>
        </td>
      </tr>
    </table>
    <br>
    <table class="table">
      <caption>
        Shared Worker <mark>SharedWorker</mark>
        <span class="browserSupport" title="updated : 2020-12-22">
          <span><i class="fab fa-chrome"></i> 5 </span>
          <span><i class="fab fa-firefox"></i> 29 </span>
          <span><i class="fab fa-opera"></i> 10.6 </span>
          <span><i class="fab fa-internet-explorer"></i><i class="fab fa-edge"></i> 79 </span>
          <span><i class="fab fa-safari"></i> 16 </span>
        </span>
      </caption>
      <tr>
        <th style="width:30%;"> Method </th>
        <th> Description </th>
      </tr>
      <tr>
        <td>
          new SharedWorker(<strong>url:str</strong>, <a href="https://developer.mozilla.org/en-US/docs/Web/API/SharedWorker/SharedWorker#options" target="_blank">option:obj</a>)
        </td>
        <td>
          - creates and returns a <reqval>sharedWorker</reqval>
        </td>
      </tr>
      <tr>
        <td>|</td>
        <td></td>
      </tr>
      <tr>
        <td> <strong>sharedWorker</strong>.port </td>
        <td>
          - returns the <reqval>msgPort</reqval> (connected to the global thread)
        </td>
      </tr>
      <tr>
        <td>|</td>
        <td></td>
      </tr>
      <tr>
        <td> <strong>sharedWorker</strong>.close() </td>
        <td>
          - closes the thread
        </td>
      </tr>
      <tr>
        <td>|</td>
        <td></td>
      </tr>
      <tr>
        <td colspan="2"> (in worker) <a style="background-color:white;" href="https://developer.mozilla.org/en-US/docs/Web/API/SharedWorkerGlobalScope" target="_blank">SharedWorkerGlobalScope</a> </td>
      </tr>
      <tr>
        <td>
          onconnect = <strong>fn(ev)</strong>
        </td>
        <td>
          - event triggers when the shared worker thread is connected to the main thread <br>
          - <mark><strong>ev</strong>.ports[0]</mark> returns the <reqval>msgPort</reqval> (connected to the shared worker thread)
        </td>
      </tr>
      <tr>
        <td>|</td>
        <td></td>
      </tr>
      <tr>
        <td colspan="2"> <a style="background-color:white;" href="https://developer.mozilla.org/en-US/docs/Web/API/MessagePort" target="_blank">msgPort</a> (message channel endpoint) </td>
      </tr>
      <tr>
        <td> <strong>msgPort</strong>.postMessage(<strong>msg:any</strong>) </td>
        <td>
          - sends a message to the other thread
        </td>
      </tr>
      <tr>
        <td>|</td>
        <td></td>
      </tr>
      <tr>
        <td>
          <strong>msgPort</strong>.onmessage = <reqval>fn(ev)</reqval>
        </td>
        <td>
          - event triggers when a message is received on the port
        </td>
      </tr>
      <tr>
        <td>
          <strong>msgPort</strong>.onmessageerror = <reqval>fn(ev)</reqval>
        </td>
        <td>
          - event triggers when the received message cannot be deserialized
          <span class="browserSupport" title="updated : 2025-03-26">
            <span><i class="fab fa-chrome"></i> 60 </span>
            <span><i class="fab fa-firefox"></i> 57 </span>
            <span><i class="fab fa-opera"></i> 47 </span>
            <span><i class="fab fa-internet-explorer"></i><i class="fab fa-edge"></i> 18 </span>
            <span><i class="fab fa-safari"></i> 16.4 </span>
          </span>
        </td>
      </tr>
      <tr>
        <td>|</td>
        <td></td>
      </tr>
      <tr>
        <td> <strong>msgPort</strong>.start() </td>
        <td>
          - starts the port (internally called when <mark><strong>msgPort</strong>.onmessage</mark> used)
        </td>
      </tr>
      <tr>
        <td> <strong>msgPort</strong>.close() </td>
        <td>
          - closes the port
        </td>
      </tr>
    </table>
    <h2 class="headerSection"> Notes : </h2>
    <p> - Workers don't run locally </p>
    <h2 class="headerSection"> Useful Links : </h2>
    <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API" target="_blank"> Web Workers (developer.mozilla.org) </a></p>
    <h2 class="headerSection"> Remember This : </h2>

    <h2 class="headerSection"> Description and Demonstration : </h2>
    <p> - a Web Workers is a separate process thread, it's used for CPU intensive tasks </p>
    <p> - almost all <mark>window</mark> feautres are also available in workers, but workers <u>have no access to the DOM</u>, workers communicate with the main thread throuh <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Structured_clone_algorithm" target="_blank">Structure Clone Algorithm</a> </p>
    <p> There are 2 types of Workers: </p>
    <p class="indent-lv1"> - <mark class="mark">Dedicated Worker</mark>: created and accessible by a single script only </p>
    <p class="indent-lv2"> - lives as long as the page is open </p>
    <p class="indent-lv1"> - <mark class="mark">Shared Worker</mark>: accessible by any script within the same domain (ex: useful to maintain one connection application wide) </p>
    <p class="indent-lv2"> - stops when all scripts stop using it </p>
    <hr>
    <!---------------------------------------------------------------------------------------------------->
    <h2 class="header"> Dedicated Worker </h2>
    <pre>
// index.html (main thread) -------------------------------------
&lt;script&gt;
    const worker = new Worker('./worker1.js');
    
    worker.onmessage = (ev) =&gt; {                                 // tirggers when message is received
      ev.data                                                       // -> 'Hello main thread'
    }
    worker.onerror = (err) =&gt; {                                     // triggered if the worker throws an uncaught error
      err                                                              // -&gt; ErrorEvent
    }
    
    worker.postMessage('Hello worker!');                 // post message to the worker thread
    
    worker.terminate();                                 // terminates the worker
&lt;/script&gt;
    
    
// --------------------------------------------------------------
// worker1.js (worker thread) -----------------------------------
    onmessage = (ev) => {
      ev.data;                             // -> 'Hello worker
      
      // do some cpu intensive work...
      
      postMessage('Hello main thread!');      // send message back to the main thread
    }
    
    onmessageerror = (ev) => {                // triggered if the received message cannot be deserialized
      ev;
    }
    
    close()                                  // closes the worker    
    </pre>
    <hr>
    <!---------------------------------------------------------------------------------------------------->
    <h2 class="header"> Shared Worker </h2>
    <pre>
// index.html (main thread) -------------------------------------
&lt;script&gt;
    const worker = new SharedWorker('./sharedWorker.js');
    const workerPort = worker.port;                             // get message port
    
    workerPort.onmessage = (ev) => {
      console.log(ev.data);                                       // -> 'Hello main script'
    }
    
    workerPort.postMessage('Hello shared worker from script1');     // sending message to the worker
&lt;/script&gt;
    
    
// --------------------------------------------------------------
// sharedWorker.js (worker thread) ------------------------------
    onconnect = (ev) => {                                     // tirggers on connections
        const port = ev.ports[0];                             // get message port
    
        port.onmessage = (ev) => {
            ev.data;                                        // -> 'Hello shared worker from script1'      (this works but I couldn't console.log out it)
            
            port.postMessage('Hello main scripts');           // post message to the main thread
        };
    
        port.start();                                         // -! port must be started
    };
    </pre>

    <br><br>
  </body>
</html>