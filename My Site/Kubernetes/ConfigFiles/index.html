<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <title> Demo </title>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link rel="stylesheet" href="../../Assets/stylesPages.css">
    <script src="../../Assets/scriptPages.js"></script>
  </head>

  <body>
    <h1> Config Files </h1>
    <p> Updated: ( 2025-09-17 ) </p>
    <nav class="sitenav">
      <a href="../../index.html">MySite > </a>
      <a href="../index.html">Kubernetes > </a> Config Files
    </nav>
    <h2 class="headerSection"> Notes : </h2>

    <h2 class="headerSection"> Useful Links : </h2>

    <h2 class="headerSection"> Remember This : </h2>

    <h2 class="headerSection"> Description and Demonstration : </h2>
    <p> - Kubernetes config files have 3 sections: <mark class="mark">metadata</mark>, <mark class="mark">specification</mark> and <mark class="mark">status</mark> (the status is automatically generated, Kubernetess uses it to compare the desired VS actual status from here) </p>
    <p> - components are identified by lables and names then referenced by other components </p>
    <!----------------------------------------------------------------------------------------------->
    <hr>
    <img src="ExampleCluster.png" alt="ExampleCluster.png">
    <p> - config files below describe this architecture </p>
    <pre>
// mongo-configmap.yaml (file)
    apiVersion: v1
    kind: ConfigMap
    metadata:
      name: mongo-configmap
      namespace: mongo-ns
    data:
      database_url: mongo-db-service       // service name
    </pre>
    <pre>
// mongo-secret.yaml (file)
    apiVersion: v1
    kind: Secret
    metadata:
      name: mongo-secret
      namespace: mongo-ns
    type: Opaque
    data:
      mongo-root-username: dGVzdFVzZXI=       # testUser        // secrets must be base64 encoded
      mongo-root-password: dGVzdFBhc3N3b3Jk   # testPassword
    </pre>
    <pre>
// mongo-ingress.yaml (file)
    apiVersion: networking.k8s.io/v1
    kind: Ingress
    metadata:
      name: mongo-ingress
      namespace: mongo-ns
    spec:
      ingressClassName: nginx
      rules:
      - host: localhost                         // exposed on hostname
        http:
          paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: mongodb-express-service     // references the mongo-express-service service 
                port:
                  number: 8081                    // service exposed on port
    </pre>
    <pre>
// mongo-db.yaml (file) 
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      name: mongo-db-deployment
      namespace: mongo-ns
      labels:
        app: mongo-db
    spec:
      replicas: 1
      selector:
        matchLabels:
          app: mongo-db
      template:
        metadata:
          labels:
            app: mongo-db
        spec:
          containers:
          - name: mongo-db
            image: mongo:8.0                      // container
            ports:
            - containerPort: 27017
            env:                                  // environment variables for the container
            - name: MONGO_INITDB_ROOT_USERNAME
              valueFrom:
                secretKeyRef:                     // get value from secret
                  name: mongo-secret              // references the secret name
                  key: mongo-root-username        // references the secret key's value
            - name: MONGO_INITDB_ROOT_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: mongo-secret
                  key: mongo-root-password
    ---                                           // config separator -> several configs can be declared in the same file
    apiVersion: v1
    kind: Service
    metadata:
      name: mongo-db-service
      namespace: mongo-ns
    spec:
      selector:
        app: mongo-db                             // service references the deployment by its label
      ports:
        - protocol: TCP
          port: 27017
          targetPort: 27017
    </pre>
    <pre>
// mongo-express.yaml (file) 
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      name: mongo-express-deployment
      namespace: mongo-ns
      labels:
        app: mongo-express
    spec:
      replicas: 1
      selector:
        matchLabels:
          app: mongo-express
      template:
        metadata:
          labels:
            app: mongo-express
        spec:
          containers:
          - name: mongo-express
            image: mongo-express:1.0
            ports:
            - containerPort: 8081
            env:
            - name: ME_CONFIG_MONGODB_ADMINUSERNAME
              valueFrom:
                secretKeyRef:
                  name: mongo-secret
                  key: mongo-root-username
            - name: ME_CONFIG_MONGODB_ADMINPASSWORD
              valueFrom:
                secretKeyRef:
                  name: mongo-secret
                  key: mongo-root-password
            - name: ME_CONFIG_MONGODB_SERVER
              valueFrom:
                configMapKeyRef:              // get value from configmap
                  name: mongo-configmap       // references the configmap
                  key: database_url           // references the secret key's value
    ---
    apiVersion: v1
    kind: Service
    metadata:
      name: mongodb-express-service
      namespace: mongo-ns
    spec:
      selector:
        app: mongo-express                        // service references the deployment by its label
      ports:
        - protocol: TCP
          port: 8081
          targetPort: 8081
    </pre>

    <br><br>
  </body>

</html>