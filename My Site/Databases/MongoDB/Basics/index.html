<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <title> MongoDB </title>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link rel="stylesheet" href="../../../Assets/stylesPages.css">
    <script src="../../../Assets/scriptPages.js"></script>
  </head>
  <body>
    <h1> MongoDB </h1>
    <p> Updated ( 2024-06-16 ) </p>
    <nav class="sitenav"> <a href="../../../index.html">MySite > </a>
      <a href="../../index.html" title="Learn WebDesign">Databases > </a>
      <a href="../index.html" title="Learn WebDesign">MongoDB > </a> Basics
    </nav>
    <table class="table">
      <caption>
        Mongo Shell
      </caption>
      <tr>
        <th style="width:30%;"> CMD </th>
        <th> Description </th>
      </tr>
      <tr>
        <td>
          mongosh <opt>[options]</opt>
        </td>
        <td>
          - enter Mongo Shell <br>
          - if authentication enabled, we still can enter the mongo shell but our acctions are restricted <br>
          <opt>[options]</opt> <br>
          - (<opt>-u <optval>user</optval></opt>) user for authentication <br>
          - (<opt>-p <optval>password</optval></opt>) password for authentication
        </td>
      </tr>
      <tr>
        <td>
          exit
        </td>
        <td>
          - (from Mongo Shell) exit from Mongo Shell
        </td>
      </tr>
      <tr>
        <td>|</td>
        <td></td>
      </tr>
      <tr>
        <td>
          cls
        </td>
        <td>
          - clear screen
        </td>
      </tr>
    </table>
    <br>
    <table class="table">
      <caption>
        GridFS
      </caption>
      <tr>
        <th style="width:30%;"> CMD </th>
        <th> Description </th>
      </tr>
      <tr>
        <td>
          <lit>mongofiles</lit> <opt>[options]</opt> --db=<reqval>db</reqval> <optval>connectionString</optval> list
        </td>
        <td>
          - list stored files in the targeted database <br>
          <opt>[options]</opt> <a href="https://www.mongodb.com/docs/database-tools/mongofiles/#options" target="_blank">[link]</a>
        </td>
      </tr>
      <tr>
        <td>
          <lit>mongofiles</lit> <opt>[options]</opt> --db=<reqval>db</reqval> <optval>connectionString</optval> search <reqval>fileName</reqval>
        </td>
        <td>
          - searches stored files in the specified database (word part search) <br>
          <opt>[options]</opt> <a href="https://www.mongodb.com/docs/database-tools/mongofiles/#options" target="_blank">[link]</a>
        </td>
      </tr>
      <tr>
        <td>|</td>
        <td></td>
      </tr>
      <tr>
        <td>
          <lit>mongofiles</lit> <opt>[options]</opt> --local=<reqval>filePath</reqval> --db=<reqval>db</reqval> <optval>connectionString</optval> put <reqval>fileName</reqval>
        </td>
        <td>
          - stores the targeted file (<reqval>filePath</reqval>) as <reqval>fileName</reqval> in <reqval>db</reqval> database as gridFS <br>
          <opt>[options]</opt> <a href="https://www.mongodb.com/docs/database-tools/mongofiles/#options" target="_blank">[link]</a>
        </td>
      </tr>
      <tr>
        <td>
          <lit>mongofiles</lit> <opt>[options]</opt> --local=<reqval>filePath</reqval> --db=<reqval>db</reqval> <optval>connectionString</optval> get <reqval>fileName</reqval>
        </td>
        <td>
          - copies the file <reqval>fileName</reqval> to <reqval>filePath</reqval> (to local file system, <reqval>filePath</reqval> must include the desired file name) <br>
          <opt>[options]</opt> <a href="https://www.mongodb.com/docs/database-tools/mongofiles/#options" target="_blank">[link]</a> <br>
        </td>
      </tr>
      <tr>
        <td>
          <lit>mongofiles</lit> <opt>[options]</opt> --db=<reqval>db</reqval> <optval>connectionString</optval> delete <reqval>fileName</reqval>
        </td>
        <td>
          - deletes <reqval>fileName</reqval> <br>
          <opt>[options]</opt> <a href="https://www.mongodb.com/docs/database-tools/mongofiles/#options" target="_blank">[link]</a> <br>
        </td>
      </tr>
    </table>
    <br>
    <table class="table">
      <caption>
        Backup
      </caption>
      <tr>
        <th style="width:30%;"> CMD </th>
        <th> Description </th>
      </tr>
      <tr>
        <td colspan="2"> collection backup </td>
      </tr>
      <tr>
        <td>
          <lit>mongoexport</lit> --collection=<reqval>collection</reqval> --db=<reqval>db</reqval> --out=<reqval>filePath.json</reqval> <optval>connectionString</optval>
        </td>
        <td>
          - exports the targeted collection in <reqval>filePath.json</reqval> <br>
          - <a href="https://www.mongodb.com/docs/database-tools/mongoexport/" target="_blank">[link]</a>
        </td>
      </tr>
      <tr>
        <td>
          <lit>mongoimport</lit> --collection=<reqval>collection</reqval> --db=<reqval>db</reqval> <optval>connectionString</optval> <reqval>filePath.json</reqval>
        </td>
        <td>
          - imports the <reqval>filePath.json</reqval> as collection in the targeted database <br>
          - <a href="https://www.mongodb.com/docs/database-tools/mongoimport/" target="_blank">[link]</a>
        </td>
      </tr>
      <tr>
        <td colspan="2"> database backup </td>
      </tr>
      <tr>
        <td>
          <lit>mongodump</lit> <opt>[options]</opt>
        </td>
        <td>
          - creates a <mark>dump</mark> directory where backups all databases <br>
          <opt>[options]</opt><br>
          - (<opt>--db=<optval>db</optval></opt>) dumps only the specified database <br>
          - (<opt>--out=<optval>dirPath</optval></opt>) specifies the directory where the database dump(s) will be stored <br>
          - <a href="https://www.mongodb.com/docs/database-tools/mongodump/" target="_blank">[link]</a>
        </td>
        <tr>
          <td>
            <lit>mongorestore</lit> <opt>[options]</opt> <optval>dirPath</optval>
          </td>
          <td>
            - restores all databases from the local <mark>dump</mark> directory <u>(does not override existing documents)</u> <br>
            - <optval>dirPath</optval> - directory to database backup(s) (<optval>dirPath/dbName</optval> to restore a specific database)<br>
            <opt>[options]</opt><br>
            - (<opt>--db=<optval>db</optval></opt>) specifies the database name in MongoDB <br>
            - <a href="https://www.mongodb.com/docs/database-tools/mongorestore/" target="_blank">[link]</a>
          </td>
        </tr>

      </table>
      <details class="example" id="notes">
        <summary> Notes & Tips :</summary>
        <!-- <p> - paragraph removes the 'empty' message from the detail TAG -->
      </details>
      <h2 class="headerSection"> Useful Links : </h2>

      <h2 class="headerSection"> Remember This : </h2>

      <h2 class="headerSection"> Description and Demonstration : </h2>
      <p> - MongoDB is an open source NoSQL document-oriented database </p>
      <p> - MongoDB runs as a daemon, we can access it by: </p>
      <p class="indent-lv1"> - Mongo Shell: CLI shell provided on installation </p>
      <p class="indent-lv1"> - Compass: MongoDB GUI </p>
      <p class="indent-lv1"> - Various drivers: provided to different programming languages (ex: for JavaScript we have the <mark>mongoose</mark> library) </p>
      <p> - MongoDB namespaced in hierarchy <mark class="mark">Databases</mark> -> <mark class="mark">Collections</mark> -> <mark class="mark">Documents</mark> </p>
      <p> - documents store the actual data in BSON format (which is basically a binary version of JSON with enhanced data types (B = binary)) </p>
      <p> - documents can store up to 16MB of data and each document has its own unique <mark>_id</mark> field </p>
      <p> - by default documents are schemaless, but we can enforce shema validation if we want to <a href="https://www.mongodb.com/docs/manual/core/schema-validation/" target="_blank">[link]</a> </p>
      <img style="display:block; margin:auto;" src="MongoDB Structure.png" height="300">
      <pre class="syntax">
  var <reqval>var</reqval> = <reqval>exp</reqval>         // variable in mongo shell
  </pre>
      <hr>
      <!------------------------------------------------------------------------------------------------------>
      <h2 class="header"> GridFS <a href="https://www.mongodb.com/docs/manual/core/gridfs/" target="_blank">[link]</a> </h2>
      <p> - with GirdFS we can store large files in MongoDB </p>
      <p> - MongoDB sotores these files in 2 different collections (for performance reasons): </p>
      <p class="indent-lv1"> - <mark class="mark">chunk</mark> collection: the acutual file stored by 255KB chunks </p>
      <p class="indent-lv1"> - <mark class="mark">files</mark> collection: file metadata storage </p>
      <p> - locally we can access the GridFS by using the <mark>mongofiles</mark> CLI tool, but each programming language has its own driver to access it </p>
      <p><u>Advantages of using GridFS:</u></p>
      <p class="indent-lv1"> - files and data are stored in the same database </p>
      <p class="indent-lv1"> - all MongoDB features are provided for storing large files (backup, replication, access control, etc...) </p>
      <p class="indent-lv1"> - different file parts can be accessed, this is awesome for media streaming! (available for drivers only) </p>
      <p><u> Disadvantages of using GridFS:</u></p>
      <p class="indent-lv1"> - not really suited to store a large number of files (because of the lack of strucured storage like we have with FS) </p>
      <p class="indent-lv1"> - if your files are smaller than 16MB store them in document as BinaryData </p>
      <details class="example">
        <summary> Example : </summary>
        <pre class="cmd">
    mongofiles --db=file_storage --local=test.txt put test_1            // storing files 
    mongofiles --db=file_storage --local=test2.txt put test_2
    
    mongofiles --db=file_storage list                                   // list stored files
    
    mongofiles --db=file_storage seach 2                            // search for files having <mark>2</mark> in the filename
    
    mongofiles --db=file_storage --local=./my_file.txt get test_1         // copies the stored <mark>test_1</mark> file as <mark>my_file.txt</mark> in the current local directory 
    
    mongofiles --db=file_storage delete test_1                       // deletes the stored <mark>test_1</mark> file from the gridFS storage 
      </pre>
      </details>
      <hr>
      <!------------------------------------------------------------------------------------------------------>
      <h2 class="header"> Backup tools </h2>
      <p> - the <mark>mongoexport</mark> and <mark>mongoimport</mark> CLI can be used to backup / resotre collections </p>
      <p> - the <mark>mongodump</mark> and <mark>mongoresotre</mark> CLI can be used to backup / resotre databases </p>
      <details class="example">
        <summary> Example : </summary>
        <h4 class="header"> Backup / Restore collections (<mark>mongoexport</mark> / <mark>mongoimport</mark>) </h4>
        <pre class="cmd">
    mongoexport --collection=col1 --db=test_db --out=col1_backup.json       // exports the collections
    
    mongoimport --collection=col1 --db=test_db col1_backup.json           // imports the collections as <mark>col2</mark> collections
        </pre>
        <hr>
        <!----------------------------------------------------------------------------------------->
        <h4 class="header"> Backup / Restore databases (<mark>mongodump</mark> / <mark>mongorestore</mark>) </h4>
        <pre class="cmd">
// backup ---------------------------
    mongodump                     // creates a <mark>dump</mark> directory then creates a backup file for each database in it
    
    mongodump --db=test_db          // creates a <mark>dump</mark> directory then creates a backup file for the <mark>test_db</mark> database in it
    
    mongodump --db=test_db --out=backup         // creates a <mark>backup</mark> directory then creates a backup file for the <mark>test_db</mark> database in it (<mark>backup/test_db</mark>)
    
    
// restore ---------------------------
    mongorestore                  // tries to restore all databases from a local <mark>dump</mark> directory 
    
    mongorestore backup           // restores all databases stored in the <mark>backup</mark> folder
    
    mongoresotre --db=new_db backup/test_db        // from the <mark>backup</mark> folder restores the <mark>test_db</mark> as <mark>new_db</mark> database 
    </pre>
      </details>
      <hr>
      <!------------------------------------------------------------------------------------------------------>
      <h2 class="header"> Authentication <a href="https://www.mongodb.com/docs/manual/core/authentication/" target="_blank">[link]</a></h2>
      <p> - MongoDB provide lots of authentication mechanisms, the most common authentication method is SCRAM (Salted Challenge Response Authentication Mechanism) (user + password authentication) </p>
      <p> - by default authentication is disabled (for easy hands on experience), but it's highly recommended to enable it for real data storage </p>
      <p> - authentication can be enable through the mongo config file <a href="https://www.mongodb.com/docs/manual/reference/configuration-options/#configuration-file" target="_blank">[link]</a> (restart the server once authentication is enabled) </p>
      <p> - after the authentication is enabled we are allowed to <u>create <b>one</b> user if we connect through <mark>mongosh</mark> from localhost</u> </p>
      <p> - the authentication is valid for all MongoDB tools (ex: <mark>mongodump</mark>) </p>
      <p> - MongoDB authentication is role based (users have assigned roles to do limited actions), <a href="https://www.mongodb.com/docs/manual/reference/built-in-roles/" target="_blank">[MongoDB user roles]</a> </p>
      <pre class="syntax">
// MongoDB config file -
    security:
        authorization: enabled|disabled                // enables|disables authentication
      </pre>
      <pre class="syntax">
// get current user --------------
    db.runCommand({ connectionStatus: 1 }).authInfo.authenticatedUsers
    
    
// list users -----------------
    use <reqval>db</reqval>         // select db where the user is (<mark>admin</mark> for administrators)   
    db.getUsers()
    
    
// create new user -----------
    use <reqval>db</reqval>         // select db where the user is (<mark>admin</mark> for administrators)   
    db.createUser({
      user: '<reqval>user</reqval>',
      pwd: '<reqval>password</reqval>'|passwordPrompt(),      // the <mark>passwordPrompt()</mark> will prompt for the password after user creation (to hide the password from shell history)
      db: '<reqval>db</reqval>'                   // db for which the user is created (<mark>admin</mark> for administrators)
      roles: [
        { role: '<a href="https:\/\/www.mongodb.com/docs/manual/reference/built-in-roles/" target="_blank">userRole</a>', db: '<reqval>db</reqval>' },    // list user roles for databases
        <optval>...</optval>
      ]
    })
    
    
// delete user ------------------
    use <reqval>db</reqval>         // select db where the user is (<mark>admin</mark> for administrators)   
    db.dropUser('<reqval>user</reqval>')
      </pre>
      <pre class="cmd">
    use admin                                         // create admin user with full access
    db.createUser(
      {
        user: "myUserAdmin",
        pwd: passwordPrompt(),
        roles: [
          { role: "userAdminAnyDatabase", db: "admin" },
          { role: "readWriteAnyDatabase", db: "admin" }
        ]
      }
    )
      </pre>

      <br><br>
    </body>

  </html>