<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title> Map and WeakMap </title>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link rel="stylesheet" href="../../../Assets/stylesPages.css">
    <script src="../../../Assets/scriptPages.js"></script>
  </head>
  <body>
    <h1> Map and WeakMap </h1>
    <p> Updated: ( 2018-07-10 / 2019-12-16 / 2025-03-06 )</p>
    <nav class="sitenav">
      <a href="../../../index.html">MySite > </a>
      <a href="../../index.html">JavaScript > </a>
      <a href="../index.html"> Objects > </a> Map and WeakMap
    </nav>
    <table class="table">
      <caption>
        Map Object
        <span id="browserSupport" title="updated : 2025-03-06">
          <span><i class="fab fa-chrome"></i> 38 </span>
          <span><i class="fab fa-firefox"></i> 13 </span>
          <span><i class="fab fa-opera"></i> 25 </span>
          <span><i class="fab fa-internet-explorer"></i><i class="fab fa-edge"></i> 11 </span>
          <span><i class="fab fa-safari"></i> 8 </span>
          <span><i class="fab fa-node-js"></i> 0.12 </span>
        </span>
      </caption>
      <tr>
        <th style="width:30%;"> Method / Property </th>
        <th> Descriptions </th>
      </tr>
      <tr>
        <td> new Map(<i>iterbaleObj</i>) </td>
        <td> - creates and returns a new Map object from the passed iterable object (iterator object must contain key value pairs like <mark>[[key, val], ...]</mark>) <br>
        </td>
      </tr>
      <tr>
        <td>|</td>
        <td></td>
      </tr>
      <tr>
        <td> <strong>map</strong>.size </td>
        <td> - returns the number of key-value pairs held by the map object
        </td>
      </tr>
      <tr>
        <td> <strong>map</strong>.get(<strong>key:any</strong>) </td>
        <td> - returns the associated value of the passed key, if no such key found returns <mark>undefined</mark>
        </td>
      </tr>
      <tr>
        <td> <strong>map</strong>.set(<strong>key:any</strong>, <strong>val:any</strong>) </td>
        <td> - adds a new key-value pair at the end of the row and returns the map object itself (with the newly added key-value pair)
        </td>
      </tr>
      <tr>
        <td> <strong>map</strong>.has(<strong>key:any</strong>) </td>
        <td> - returns <mark>true</mark> if the passed value exist as key in the map object, otherwise returns <mark>false</mark>
        </td>
      </tr>
      <tr>
        <td> <strong>map</strong>.forEach(<strong>fn(key, val, mapObj)</strong>, <i>thisValue</i>) </td>
        <td> - runs the callback fuction for each key-value pair in the map object in the insertion order
        </td>
      </tr>
      <tr>
        <td>|</td>
        <td></td>
      </tr>
      <tr>
        <td> <strong>map</strong>.delete(<strong>key:any</strong>) </td>
        <td> - removes the specified key-value pair (referenced by the key) from the map object, and returns a boolean indicating the success or the failure of the operation <br>
          - this does not leave a hole in the Map object, itmes (key-value pairs) will shift to fill the gap
        </td>
      </tr>
      <tr>
        <td> <strong>map</strong>.clear() </td>
        <td> - removes all items (key-value pairs) from the map object (no return value)
        </td>
      </tr>
      <tr>
        <td>|</td>
        <td></td>
      </tr>
      <tr>
        <td> <strong>map</strong>.keys() </td>
        <td> - returns an iterator object containing the Map object's all keys
        </td>
      </tr>
      <tr>
        <td> <strong>map</strong>.values() </td>
        <td> - returns an iterator object containing the Map object's all values
        </td>
      </tr>
      <tr>
        <td> <strong>map</strong>.entries() </td>
        <td> - returns an iterator object containing the Map object's key-value pairs
        </td>
      </tr>
      <tr>
        <td>|</td>
        <td></td>
      </tr>
      <tr>
        <td> <lit>Map</lit>.groupBy(<reqval>arr</reqval>, <reqval>fn(member, idx)</reqval>) </td>
        <td> 
          - <span class="fab fa-js">2019</span> groups <reqval>arr</reqval> member by runing the callback for each items <br>
          - the callback returns a string which is the group key, the result is a Map with the grouped members (ex: <mark>Map([[<reqval>groupKey</reqval>: [<reqval>member</reqval><optval>, ...</optval>]<optval>, ...</optval>]<optval>, ...</optval>])</mark>)
        <span id="browserSupport" title="updated : 2025-03-07">
          <span><i class="fab fa-chrome"></i> 117 </span>
          <span><i class="fab fa-firefox"></i> 119 </span>
          <span><i class="fab fa-opera"></i> 103 </span>
          <span><i class="fab fa-internet-explorer"></i><i class="fab fa-edge"></i> 117 </span>
          <span><i class="fab fa-safari"></i> 17.4 </span>
          <span><i class="fab fa-node-js"></i> 21 </span>
        </span>
        </td>
      </tr>
    </table>
    <br>
    <table class="table">
      <caption>
        WeakMap Object
        <span id="browserSupport" title="updated : 2025-03-06">
          <span><i class="fab fa-chrome"></i> 36 </span>
          <span><i class="fab fa-firefox"></i> 6 </span>
          <span><i class="fab fa-opera"></i> 23 </span>
          <span><i class="fab fa-internet-explorer"></i><i class="fab fa-edge"></i> 11 </span>
          <span><i class="fab fa-safari"></i> 8 </span>
          <span><i class="fab fa-node-js"></i> 0.12 </span>
        </span>
      </caption>
      <tr>
        <th style="width:30%;"> Method / Property </th>
        <th> Descriptions </th>
      </tr>
      <tr>
        <td> new WeakMap(<i>iterableObj</i>) </td>
        <td> - creates and returns a WeakMap object from the passed iterable object (iterator object must contain key-value pairs like <mark>[[key, val], ...]</mark>) <br>
        </td>
      </tr>
      <tr>
        <td>|</td>
        <td></td>
      </tr>
      <tr>
        <td> <strong>weakMap</strong>.get(<strong>key:objRef</strong>) </td>
        <td> - returns the associated value of the passed key, if no such key found returns <mark>undefined</mark>
        </td>
      </tr>
      <tr>
        <td> <strong>weakMap</strong>.has(<strong>key:objRef</strong>) </td>
        <td> - returns <mark>true</mark> if the passed value exist as key in the weakmap object, otherwise returns <mark>false</mark>
        </td>
      </tr>
      <tr>
        <td> <strong>weakMap</strong>.set(<strong>key:objRef</strong>, <strong>val:any</strong>) </td>
        <td> - adds a new key-value pair and returns the weakmap object itself (newly added key-value pair included)
        </td>
      </tr>
      <tr>
        <td>|</td>
        <td></td>
      </tr>
      <tr>
        <td> <strong>weakMap</strong>.delete(<strong>key:objRef</strong>) </td>
        <td> - removes the specified key-value pair (referenced by the key) from the weakmap object, and returns a boolean indicating the success or the failure of the operation
        </td>
      </tr>
    </table>
    <h2 class="headerSection"> Notes : </h2>
    
    <h2 class="headerSection"> Useful Links : </h2>
    <p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map" target="_blank"> MDN Map Object </a></p>
    <h2 class="headerSection"> Remember This : </h2>
    <p> - Map and WeakMap allows keys to be objects or object references, this data structure can be useful to hold some metadata for the object </p>
    <h2 class="headerSection"> Description and Demonstration : </h2>
    <p> <mark class="mark">Map</mark> object: </p>
    <p class="indent-lv1"> - iterable collection that holds key-value pairs </p>
    <p class="indent-lv1"> - keys can be any primitives, object or object reference </p>
    <p class="indent-lv1"> - if the object that is refeneced by a Map key is deleted the Map will keep the original object (not garbage collected) </p>
    <p class="indent-lv1"><u> Usage: </u></p>
    <p class="indent-lv2"> - normal iterable key-value pair data structure </p>
    <p class="indent-lv2"> - holding some metadata for objects (key = object reference, value = some meta data) </p>
    <p> <mark class="mark">WeakMap</mark> object: </p>
    <p class="indent-lv1"> - holds key-value pairs <u>(not iterable)</u> </p>
    <p class="indent-lv1"> - keys can be only be object references </p>
    <p class="indent-lv1"> - if the object that is refeneced by a WeakMap key is deleted the WeakMap will not keep the original object (garbage collected) </p>
    <p class="indent-lv1"><u> Usage: </u></p>
    <p class="indent-lv2"> - holding some metadata for objects (key = object reference, value = some meta data) </p>
    <pre>
// Map ---------------------------------------------
  // normal key-value pair iterable data structure -
    const persons = new Map()
    
    persons.set('Eva', { name: 'Eva', sex: 'F' })
    persons.get('Eva')                                // -> { name: 'Eva', sex: 'F' }
    
    
  // holding metadata for objects ------------------
    let eva = { name: 'Eva', sex: 'F' }
    
    const persons = new Map()
    persons.set(eva, { created: Date.now() })     // metadata for the eva object
    
    persons.get(eva)                            // -> { created: 1741326886429 }
    
    eva = null;                                // deleting object
    
    persons.entries();                // -> [ { name: 'Eva', sex: 'F' }, { created: 1741326689230 }   // the Map keeps the object (not garbage collected)
    
    
// WeakMap -----------------------------------------
  // holding metadata for objects ------------------
    let eva = { name: 'Eva', sex: 'F' }
    
    const persons = new WeakMap()
    persons.set(eva, { created: Date.now() })     // metadata for the eva object
    
    persons.get(eva)                            // -> { created: 1741326886429 }
    
    eva = null;                                // deleting object
    
    persons.get(eva)                                 // -> undefined      // the WeakMap does not keep deleted object (garbage collected)
    </pre>
    <h2 class="headerExtra"> The <mark>Map</mark> Object </h2>
    <details class="example">
      <summary> DEMO </summary>
      <pre>
    var myMap = new Map([
        [false, 'value1'],
        [2, [1, 2, 3]],                                                                 
        [2, {p1:'val'}],                                                               // overwrites the previous same key (key-value pair)
        [[1], 32],                                                                     // bot key-value pair is kept because the Map object doesn't do same object checking  
        [[1], 21]                                                                      // bot key-value pair is kept because the Map object doesn't do same object checking  
    ]);
    
    myMap;                                                                             // -> Map{[false, 'value1'], [2, {p1:'val'}], [[1], 32], [[1], 21]}
// ------------------------------------------------------------------------------------
    for(let i of myMap) {                                                              // Map is an iterator object os the for... of loop can loop over it 
        i                                                                              // -> [false, 'value1'] | [2, {p1:'val'}] | [[1], 32] | [[1], 21]
    }
    </pre>
    </details>
    <!---------------------------------------------------------------------------------------------------------------------------->
    <hr>
    <h3 class="header"> The <mark>size</mark> / <mark>get()</mark> / <mark>set()</mark> / <mark>has()</mark> / <mark>forEach()</mark> property and methods </h3>
    <details class="example">
      <summary> DEMO </summary>
      <pre>
    var myMap = new Map([['mark', 'BMW'], ['sport', true]]);
    
// size -------------------------------------------------------------------------------
    myMap.size;                                                                        // -> 2
    
// get() ------------------------------------------------------------------------------
    myMap.get('sport');                                                                // -> true 
    myMap.get('color');                                                                // -> undefined                                                  // no such key found 
    
// has() / set() ----------------------------------------------------------------------
    myMap.has(3000);                                                                   // -> false                                                      // no such key found
    myMap.set(3000, 'engine');                                                         // -> Map{['mark', 'BMW'], ['sport', true], [3000, 'engine']}    // new key-value pair added at the end of the row  
    myMap.has(3000);                                                                   // -> true 
    
// forEach() --------------------------------------------------------------------------
    myMap.forEach(function(key, val, mapObj){                                          // runs one pass for each key-value pairs  
        key;                                                                           // -> 'mark' | 'sport' | 3000
        val;                                                                           // -> 'BMW'  | true    | 'engine'
        mapObj;                                                                        // -> Map{['mark', 'BMW'], ['sport', true], [3000, 'engine']} | ...
    });
    </pre>
    </details>
    <!---------------------------------------------------------------------------------------------------------------------------->
    <hr>
    <h3 class="header"> The <mark>delete()</mark> / <mark>clear()</mark> methods </h3>
    <details class="example">
      <summary> DEMO </summary>
      <pre>
    var myMap = new Map([["p1", 33], ["p2", 32]]);
    
// delete() ---------------------------------------------------------------------------
    myMap.delete('p2');                                                                // -> true       // key-value pair successfully removed 
    myMap.delete('p3');                                                                // -> false      // operation failed (no such key exist)   
    
// clear() ----------------------------------------------------------------------------
    myMap.clear();                                                                     // map object cleared entirely 
    myMap;                                                                             // -> Map{}
    </pre>
    </details>
    <!---------------------------------------------------------------------------------------------------------------------------->
    <hr>
    <h3 class="header"> The <mark>keys()</mark> / <mark>values()</mark> / <mark>entries()</mark> methods </h3>
    <details class="example">
      <summary> DEMO </summary>
      <pre>
    var myMap = new Map([['str', 21], [false, 32n], [null, undefined]]);
    
    var keyIterator = myMap.keys();                                                    // -> MapIterator{'str', false, null}
        keyIterator.next();                                                            // -> {value:'str', done:false}
    
    var valIterator = myMap.values();                                                  // -> MapIterator{21, 32n, undefined}
        valIterator.next();                                                            // -> {value:21, done:false}
        
    var entriesIterator = myMap.entries();                                             // -> MapIterator{['str', 21], [false, 32n], [null, undefined]}
        entriesIterator.next();                                                        // -> {value:['str', 21], done:false}
    </pre>
    </details>
    <!---------------------------------------------------------------------------------------------------------------------------->
    <hr>
    <h3 class="header"> The <mark>Map.group()</mark> static method </h3>
    <details class="example">
      <summary> DEMO </summary>
      <pre>
    const cars = [
      { mark: 'Audi', subMark: 'A4', year: 2021 },
      { mark: 'Audi', subMark: 'Q5', year: 2018 },
      { mark: 'BMW', subMark: 'X3', year: 2024 },
      { mark: 'BMW', subMark: 'M3', year: 2016 },
      { mark: 'BMW', subMark: 'i4', year: 2022 },
      { mark: 'Mercedes', subMark: 'C-Class', year: 2013 },
      { mark: 'Mercedes', subMark: 'E-Class', year: 2022 },
    ];
    
    Map.groupBy(cars, ({ year }) => year >= 2020 ? 'new' : 'old')
    // result:
    // Map(
    //   new: [
    //     { mark: 'Audi', subMark: 'A4', year: 2021 },
    //     { mark: 'BMW', subMark: 'X3', year: 2024 },
    //     { mark: 'BMW', subMark: 'i4', year: 2022 },
    //     { mark: 'Mercedes', subMark: 'E-Class', year: 2022 }
    //   ],
    //   old: [
    //     { mark: 'Audi', subMark: 'Q5', year: 2018 },
    //     { mark: 'BMW', subMark: 'M3', year: 2016 },
    //     { mark: 'Mercedes', subMark: 'C-Class', year: 2013 }
    //   ]
    // )
    
    
    Map.groupBy(cars, ({ mark }) => mark)
    // result:
    // Map(
    //   Audi: [
    //     { mark: 'Audi', subMark: 'A4', year: 2021 },
    //     { mark: 'Audi', subMark: 'Q5', year: 2018 }
    //   ],
    //   BMW: [
    //     { mark: 'BMW', subMark: 'X3', year: 2024 },
    //     { mark: 'BMW', subMark: 'M3', year: 2016 },
    //     { mark: 'BMW', subMark: 'i4', year: 2022 }
    //   ],
    //   Mercedes: [
    //     { mark: 'Mercedes', subMark: 'C-Class', year: 2013 },
    //     { mark: 'Mercedes', subMark: 'E-Class', year: 2022 }
    //   ]
    // )
    </pre>
    </details>
    <!---------------------------------------------------------------------------------------------------------------------------->
    <hr>
    <h2 class="headerExtra"> The <mark>WeakMap</mark> Object </h2>
    <details class="example">
      <summary> DEMO </summary>
      <pre>
// !! the WeakMark object marks unreferenced object references (as key) for gargabe collection, BUT the garbage collection is platform specific, so this code might result different outcomes depending on platform garbage collection speed    
    var myObj1 = {p1:'val1'}
    var myObj2 = {p2:'val2'}
    
    var myWeakMap = new WeakMap([[myObj1, 1], [myObj2, 2], [{p3:'val3'}, 3]]);         // the 3rd item (key-value) [{p3:'val3'}, 3] is automatically garbage collected because it is not referenced   
    
    myWeakMap;                                                                         // -> WeakMap{[myObj1, 1], [myObj2, 2]}
        
    var myObj2 = 'new value';                                                          // the 'myObj2' variable not references the {p2:'val2'} object any more 
    
    myWeakMap;                                                                         // -> WeakMap{[myObj1, 1]}           // the [myObj2, 2] is garbage collected 
    </pre>
    </details>
    <!---------------------------------------------------------------------------------------------------------------------------->
    <hr>
    <h3 class="header"> The <mark>get()</mark> / <mark>set()</mark> / <mark>has()</mark> / <mark>delete()</mark> methods </h3>
    <details class="example">
      <summary> DEMO </summary>
      <pre>
    var myObj1 = {p1:'val1'};
    var myObj2 = {p2:'val2'};
    
    var myWeakMap = new WeakMap();
    
// get() / set() / delete() -----------------------------------------------------------
    myWeakMap.set(myObj1, 'first');                                                    // -> WeakMap{[myObj1, 'first']}     // new items (key-value pair) added    
    myWeakMap.set(myObj2, 'second');                                                   // -> WeakMap{[myObj1, 'first'], [myObj2, 'second']}
    
    myWeakMap.delete(myObj2);                                                          // -> true                           // [myObj2, 'second'] key-value pair deleted from the WeakMap object    
    myWeakMap.delete(noObj);                                                           // -> false                          // delete operation failed (no such key found)    
    
    myWeakMap.get(myObj1);                                                             // -> 'first'                        // value associated to the 'myObj1' object reference is returned  
    myWeakMap.get(myObj2);                                                             // -> undefined                      // no such WeakMap key found  
    
// has() ------------------------------------------------------------------------------
    myWeakMap.has(myObj1);                                                             // -> true                           // WeakMap contains the myObj1 object reference as key    
    
    myObj1 = 'new value';                                                              // variable has a new value assigned to (so it does not references the {p1:'val1'} object any more = WeakMap marks it and its value for garbage collection)    
    myWeakMap.has(myObj1);                                                             // -> false                          // WeakMap does not have the myObj1 object reference as key any more because it is garbage collected along with its value    
    </pre>
    </details>

    <br><br>
  </body>
</html>