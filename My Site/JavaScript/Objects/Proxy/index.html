<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title> Proxy </title>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link rel="stylesheet" href="../../../Assets/stylesPages.css">
    <script src="../../../Assets/scriptPages.js"></script>
  </head>
  <body>
    <h1> Proxy </h1>
    <p> Updated ( 2021-09-08 / 2025-03-07 )</p>
    <nav class="sitenav">
      <a href="../../../index.html">MySite > </a>
      <a href="../../index.html">JavaScript > </a>
      <a href="../index.html"> Objects > </a> Proxy
    </nav>
    <table class="table">
      <tr>
        <th style="width:30%;"> Method </th>
        <th> Description </th>
      </tr>
      <tr>
        <td>
          new Proxy(<strong>target:obj|fn</strong>, {<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/Proxy#handler_functions" target="_blank">handler</a>, <optval>...</optval>})
        </td>
        <td>
          - returns a <strong>proxy</strong> object
          <span class="browserSupport" title="updated : 2025-03-07">
            <span><i class="fab fa-chrome"></i> 49 </span>
            <span><i class="fab fa-firefox"></i> 18 </span>
            <span><i class="fab fa-opera"></i> 36 </span>
            <span><i class="fab fa-internet-explorer"></i><i class="fab fa-edge"></i> 10 </span>
            <span><i class="fab fa-safari"></i> 10 </span>
            <span><i class="fab fa-node-js"></i> 6 </span>
          </span>
        </td>
      </tr>
      <tr>
        <td>|</td>
        <td></td>
      </tr>
      <tr>
        <td>
          Proxy.revocable(<strong>target:obj|fn</strong>, {<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/Proxy#handler_functions" target="_blank">handler</a>, <optval>...</optval>})
        </td>
        <td>
          - return a <strong>revocableProxy</strong> object which has the ability to disable its <strong>proxy</strong>
          <span class="browserSupport" title="updated : 2021-09-27">
            <span><i class="fab fa-chrome"></i> 63 </span>
            <span><i class="fab fa-firefox"></i> 34 </span>
            <span><i class="fab fa-opera"></i> 50 </span>
            <span><i class="fab fa-internet-explorer"></i><i class="fab fa-edge"></i> 12 </span>
            <span><i class="fab fa-safari"></i> 10 </span>
            <span><i class="fab fa-node-js"></i> 6</span>
          </span>
        </td>
      </tr>
      <tr>
        <td>
          <strong>revocableProxy</strong>.proxy
        </td>
        <td>
          - returns the revocable proxy's <strong>proxy</strong> object
          <span class="browserSupport" title="updated : 2021-09-27">
            <span><i class="fab fa-chrome"></i> 63 </span>
            <span><i class="fab fa-firefox"></i> 34 </span>
            <span><i class="fab fa-opera"></i> 50 </span>
            <span><i class="fab fa-internet-explorer"></i><i class="fab fa-edge"></i> 12 </span>
            <span><i class="fab fa-safari"></i> 10 </span>
            <span><i class="fab fa-node-js"></i> 6 </span>
          </span>
        </td>
      </tr>
      <tr>
        <td>
          <strong>revocableProxy</strong>.revoke()
        </td>
        <td>
          - disables the revocable proxy
          <span class="browserSupport" title="updated : 2021-09-27">
            <span><i class="fab fa-chrome"></i> 63 </span>
            <span><i class="fab fa-firefox"></i> 34 </span>
            <span><i class="fab fa-opera"></i> 50 </span>
            <span><i class="fab fa-internet-explorer"></i><i class="fab fa-edge"></i> 12 </span>
            <span><i class="fab fa-safari"></i> 10 </span>
            <span><i class="fab fa-node-js"></i> 6 </span>
          </span>
        </td>
      </tr>
    </table>
    <br>
    
    <h2 class="headerSection"> Useful Links : </h2>
    <p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy" target="_blank">Proxy Object (MDN)</a></p>
    <h2 class="headerSection"> Remember This : </h2>

    <h2 class="headerSection"> Description and Demonstration : </h2>
    <p> - a Proxy object is basically a wrapper around another object, enabling to intercept and redefine operations (such as property access, assignement, etc...) </p>
    <p> - the Revocable proxy does the same as the Proxy object, but can be disabled any time </p>
    <pre>
    const eva = { name: 'Eva' }
    
    const evaProxy = new Proxy(eva, {
      get(target, prop) {                           // handler intercepts the call 
        return `Hello my name is ${target[prop]}`;
      }
    });
    
    evaProxy.name;                              // -> 'Hello my name is Eva'
    
    
// revocable proxy --------------------------------
    const eva = { name: 'Eva' }
    
    const revocableEvaProxy = Proxy.revocable(eva, {
      get(target, prop) {
        return `Hello my name is ${target[prop]}`;
      }
    });
    
    const evaProxy = revocableEvaProxy.proxy;
    evaProxy.name;                                        // -> 'Hello my name is Eva'
    
    revocableEvaProxy.revoke()                            // revoces (disables) the proxy
    evaProxy.name                                         // throws an error 
      </pre>
    <hr>
    <!---------------------------------------------------------------------------------------------------->
    <h2 class="header"> Proxy handlers </h2>
    <h3 class="header"> <mark>get</mark> / <mark>set</mark> / <mark>construct</mark> / <mark>apply</mark> / <mark>ownKeys</mark> / <mark>has</mark> / <mark>getOwnPropertyDescriptor</mark> / <mark>defineProperty</mark> / <mark>deleteProperty</mark> / <mark>getPrototypeOf</mark> / <mark>setPrototypeOf</mark> / <mark>preventExtensions</mark> / <mark>isExtensible</mark> </h3>
    <details class="example">
      <summary> DEMO </summary>
      <p> - <mark>get</mark> handler </p>
      <pre>
  const someObj1 = {p1:11};
  const someObj2 = {p1:21};
  
  const proxy = new Proxy(someObj1, {
    get(target, prop, receiver){   
      target;                                                                          // -> someObj1  |  someObj1
      prop;                                                                            // -> 'noProp'  |  'someProp' 
      receiver;                                                                        // -> someObj1  |  someObj2      // the 'receiver' is the object which is passed by Reflect    
      
      return 'mockedValue';                                                            // we return what we want  
    }
  })
  
  proxy.noProp;                                                                        // -> 'mockedValue'
  Reflect.get(proxy, 'someProp', someObj2);                                            // -> 'mockedValue'
  </pre>
      <p> - <mark>set</mark> handler </p>
      <pre>
  const someObj1 = {p1:11}
  const someObj2 = {p1:21}
  
  const proxy = new Proxy(someObj1, {
    set(target, prop, val, receiver){
      target;                                                                          // -> someObj1  |  someObj1 
      prop;                                                                            // -> 'newProp' | 'newProp2'
      val;                                                                             // -> 'newVal'  |  'newVal2'
      receiver;                                                                        // -> someObj1  |  someObj2   // the 'receiver' is the object which is passed by Reflect  
      
      target[prop] = val;                                                              // we can use anykind of business logic here to set properties   
      return true;                                                                     // we must return true 
    }
  })
  
  proxy.newProp = 'newVal';                                                            // -> {p1:11}
  Reflect.set(proxy, 'newProp2', 'newVal2', someObj2);                                 // -> true
  
  someObj1;                                                                            // -> {p1:11, newProp:'newVal', newProp2:'newVal2'}  
  </pre>
      <p> - <mark>construct</mark> handler </p>
      <pre>
  function Constructor1(a){
    this.a = a;
  }
  function Constructor2(){}
  
  const proxy = new Proxy(Constructor1, {
    construct: function(target, args, newTarget){       
      target;                                                                          // -> Constructor1  |  Constructor1  
      args;                                                                            // -> [10]          |  [20]
      newTarget;                                                                       // -> Constructor1  |  Constructor2    // the 'receiver' is the constructor passed in Reflect   
      
      return new target(args[0] + 1);                                                  // we return what we want here 
    }
  })
  
  const objA = new proxy(10);
  objA;                                                                                // -> {a:11}    
  
  const objB = Reflect.construct(proxy, [20], Constructor2);
  objB;                                                                                // -> {a:21}    
  </pre>
      <p> - <mark>apply</mark> handler </p>
      <pre>
  const someObj = {
    add: function(a, b){
      return a + b;
    }
  }
  
  const proxy = new Proxy(someObj.add, {
    apply: function(target, thisVal, args){
      target;                                                                          // -> someObj.add (function)  | someObj.add 
      thisVal;                                                                         // -> undefined               | 'x'           // this value passed in Reflect()     
      args;                                                                            // -> [2, 3]                  | [10, 20]
      
      return (args[0] + args[1]) / 2;
    }
  })
  
  proxy(2, 3);                                                                         // -> 2.5 
  Reflect.apply(proxy, 'x', [10, 20]);                                                 // -> 15 
   
// traps for calling object functions -------------------------------------------------
  const someObj = {
    someFn(a, b) {
      return a + b;
    }
  }
  
  const trap = Proxy.revocable(someObj, {
    get() {                                                                            // the get handler traps any attemt to get a property   
      return function(a, b) {                                                          // since the property is a function we return a function which is then called    
        return a + b + 1;
      }
    },
  })
  
  const proxy = trap.proxy;
  
  proxy.someFn(1, 1);                                                                  // -> 3
  </pre>
      <p> - <mark>ownKeys</mark> handler </p>
      <pre>
// Reflect.ownKeys() / Object.getOwnPropertyNames() -----------------------------------
  const someObj = {p1:21, p2:22};
  
  const proxy = new Proxy(someObj, {
    ownKeys: function(target){
      target;                                                                          // -> someObj
      
      return ['x', 'y'];                                                               // must return an Array of strings   
    }
  })
  
  Reflect.ownKeys(proxy);                                                              // -> ['x', 'y']
  Object.getOwnPropertyNames(proxy);                                                   // -> ['x', 'y']
  
// Object.keys() ----------------------------------------------------------------------
  const someObj2 = {p1:21, p2:22};
  
  const proxy2 = new Proxy(someObj2, {
    ownKeys: function(target){
      target;                                                                          // -> someObj
      
      return Object.keys(target);                                                      // must return an iterator object containing strings  
    }
  })
  
  Object.keys(proxy2);                                                                 // -> ['p1', 'p2']
  
// Object.getOwnPropertySymbols() -----------------------------------------------------
  const someObj3 = {p1:21, p2:22};
  
  const proxy3 = new Proxy(someObj3, {
    ownKeys: function(target){
      target;                                                                         // -> someObj
      
      const arr = [];
      const symbol1 = Symbol();
      arr[0] = symbol1;
      
      return arr;                                                                     // must return an Array containing Symbols (strings are ignored)    
    }
  })
  
  Object.getOwnPropertySymbols(proxy3);                                               // -> [symbol1]
  </pre>
      <p> - <mark>has</mark> handler </p>
      <pre>
  const someObj = {p1:21};
  
  const proxy = new Proxy(someObj, {
    has: function(target, prop){
      target;                                                                          // -> {p1:21}  |  {p1:21}
      prop;                                                                            // -> 'p1'     |  'noProp'
      
      return true;                                                                     // we always return true   
    }
  })
  
  'p1' in proxy;                                                                       // -> true 
  'noProp' in proxy;                                                                   // -> true 
  </pre>
      <p> <mark>getOwnPropertyDescriptor</mark> handler </p>
      <pre>
  const someObj = {p1:21};
  
  const proxy = new Proxy(someObj, {
    getOwnPropertyDescriptor: function(target, prop){
      target;                                                                          // -> {p1:21}
      prop;                                                                            // -> 'noProp'
    
      const propDescriptor = {
        configurable:true, 
        writable:true, enumerable:false, 
        value:'someVal', 
        extraProp:'ignored'                                                            // non property descriptor properties are simply ignored    
      }
      
      return propDescriptor;
    }
  })
  
  Object.getOwnPropertyDescriptor(proxy, 'noProp');                                    // -> {configurable:true, writable:true, enumerable:false, value:'someVal'}
  </pre>
      <p> <mark>defineProperty</mark> handler </p>
      <pre>
  const someObj = {p1:21, p2:22};
  
  const proxy = new Proxy(someObj, {
    defineProperty: function(target, prop, descriptor){
      target;                                                                          // -> {p1:21, p2:22}
      prop;                                                                            // -> 'newProp' 
      descriptor;                                                                      // -> {value:'x', configurable:true}      // -! invalid property descriptor properties are omitted 
    
      return true;                                                                     // must return true  
    }
  })
  
  const propertyDesc = {
    value:'x', 
    configurable:true, 
    ivalidDescriptor:true                                                              // this property will be omitted in the received handler   
  };
  
  console.log( Object.defineProperty(proxy, 'newProp', propertyDesc) );                // -> {p1:22, p2:22} 
  </pre>
      <p> <mark>deleteProperty</mark> handler </h4>
      <pre>
  const someObj = {p1:21, p2:22};
  
  const proxy = new Proxy(someObj, {
    deleteProperty: function(target, prop){
      target;                                                                          // -> {p1:21, p2:22}
      prop;                                                                            // -> 'someProp' 
    
      return true;                                                                     // must return true 
    }
  })
  
  delete proxy.someProp;                                                               // -> true 
  </pre>
      <p> <mark>getPrototypeOf</mark> handler </h4>
      <pre>
  const someObj = {p1:21, p2:22};
  
  const proxy = new Proxy(someObj, {
    getPrototypeOf: function(target){
      target;                                                                          // -> {p1:21, p2:22}
    
      return {fakeProxy:true}
    }
  })
  
  Object.getPrototypeOf(proxy);                                                        // -> {fakeProxy:true}
  </pre>
      <p> <mark>setPrototypeOf</mark> handler </p>
      <pre>
  const someObj = {p1:21, p2:22};
  
  const proxy = new Proxy(someObj, {
    setPrototypeOf: function(target, proto){
      target;                                                                          // -> {p1:21, p2:22}
      proto;                                                                           // -> {fakeProto:true}
    
      return true
    }
  })
  
  Object.setPrototypeOf(proxy, {fakeProto:true});                                      // -> {p1:21, p2:22}
  </pre>
      <p> <mark>preventExtensions</mark> handler </p>
      <pre>
  const someObj = {p1:21, p2:22};
  
  const proxy = new Proxy(someObj, {
    preventExtensions: function(target){
      target;                                                                          // -> {p1:21, p2:22}
      Object.preventExtensions(target);                                                // -! target must be not extensible before we return true 
      
      return true;
    }
  })
  
  Object.preventExtensions(proxy);                                                     // -> {p1:21, p2:22}
  </pre>
      <p> <mark>isExtensions</mark> handler </p>
      <pre>
  const someObj = {p1:21, p2:22};
  
  const proxy = new Proxy(someObj, {
    isExtensible: function(target){
      target;                                                                          // -> someObj
      
      // return false                                                                  // -! this would throw an Error, because target is extensible 
      return true
    }
  })
  
  Object.isExtensible(proxy);                                                          // -> true   
  </pre>
    </details>
    <hr>
    <!---------------------------------------------------------------------------------------------------->
    <h2 class="headerExtra"> The <mark>Reflect</mark> object <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Reflect" target="_blank">[link]</a> </h2>
    <p> - the reflect object is used to fowrad the default behaviour for proxies </p>
    <pre>
    const eva = { name: 'Eva' };
    
    const evaProxy = new Proxy(eva, {
      get(target, prop) {
        console.log('log: get called');
        
        return Reflect.get(target, prop);           // default forwarding (get call does it's normal thing we just intercept the call)
      }
    });
    
    evaProxy.name;                             // -> 'Eva'
    </pre>




    <br><br>
  </body>
</html>
